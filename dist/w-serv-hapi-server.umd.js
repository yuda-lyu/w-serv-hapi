/*!
 * w-serv-hapi-server v1.0.12
 * (c) 2018-2021 yuda-lyu(semisphere)
 * Released under the MIT License.
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("@hapi/hapi"),require("@hapi/inert"),require("events"),require("stream"),require("path"),require("fs")):"function"==typeof define&&define.amd?define(["@hapi/hapi","@hapi/inert","events","stream","path","fs"],e):(t="undefined"!=typeof globalThis?globalThis:t||self)["w-serv-hapi-server"]=e(t["@hapi/hapi"],t["@hapi/inert"],t.events,t.stream,t.path,t.fs)}(this,(function(t,e,r,n,o,i){"use strict";var u=Array.isArray,a="object"==typeof global&&global&&global.Object===Object&&global,c="object"==typeof self&&self&&self.Object===Object&&self,s=a||c||Function("return this")(),f=s.Symbol,l=Object.prototype,p=l.hasOwnProperty,h=l.toString,v=f?f.toStringTag:void 0;var d=Object.prototype.toString;var y="[object Null]",b="[object Undefined]",g=f?f.toStringTag:void 0;function m(t){return null==t?void 0===t?b:y:g&&g in Object(t)?function(t){var e=p.call(t,v),r=t[v];try{t[v]=void 0;var n=!0}catch(t){}var o=h.call(t);return n&&(e?t[v]=r:delete t[v]),o}(t):function(t){return d.call(t)}(t)}function j(t){return null!=t&&"object"==typeof t}var w="[object Symbol]";function _(t){return"symbol"==typeof t||j(t)&&m(t)==w}var O=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,S=/^\w*$/;function A(t,e){if(u(t))return!1;var r=typeof t;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=t&&!_(t))||(S.test(t)||!O.test(t)||null!=e&&t in Object(e))}function x(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}var $="[object AsyncFunction]",M="[object Function]",T="[object GeneratorFunction]",D="[object Proxy]";function k(t){if(!x(t))return!1;var e=m(t);return e==M||e==T||e==$||e==D}var U,N=s["__core-js_shared__"],B=(U=/[^.]+$/.exec(N&&N.keys&&N.keys.IE_PROTO||""))?"Symbol(src)_1."+U:"";var C=Function.prototype.toString;function E(t){if(null!=t){try{return C.call(t)}catch(t){}try{return t+""}catch(t){}}return""}var I=/^\[object .+?Constructor\]$/,F=Function.prototype,P=Object.prototype,z=F.toString,R=P.hasOwnProperty,W=RegExp("^"+z.call(R).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function L(t){return!(!x(t)||(e=t,B&&B in e))&&(k(t)?W:I).test(E(t));var e}function H(t,e){var r=function(t,e){return null==t?void 0:t[e]}(t,e);return L(r)?r:void 0}var Y=H(Object,"create");var q=Object.prototype.hasOwnProperty;var J=Object.prototype.hasOwnProperty;function V(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function G(t,e){return t===e||t!=t&&e!=e}function Z(t,e){for(var r=t.length;r--;)if(G(t[r][0],e))return r;return-1}V.prototype.clear=function(){this.__data__=Y?Y(null):{},this.size=0},V.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},V.prototype.get=function(t){var e=this.__data__;if(Y){var r=e[t];return"__lodash_hash_undefined__"===r?void 0:r}return q.call(e,t)?e[t]:void 0},V.prototype.has=function(t){var e=this.__data__;return Y?void 0!==e[t]:J.call(e,t)},V.prototype.set=function(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=Y&&void 0===e?"__lodash_hash_undefined__":e,this};var Q=Array.prototype.splice;function K(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}K.prototype.clear=function(){this.__data__=[],this.size=0},K.prototype.delete=function(t){var e=this.__data__,r=Z(e,t);return!(r<0)&&(r==e.length-1?e.pop():Q.call(e,r,1),--this.size,!0)},K.prototype.get=function(t){var e=this.__data__,r=Z(e,t);return r<0?void 0:e[r][1]},K.prototype.has=function(t){return Z(this.__data__,t)>-1},K.prototype.set=function(t,e){var r=this.__data__,n=Z(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this};var X=H(s,"Map");function tt(t,e){var r,n,o=t.__data__;return("string"==(n=typeof(r=e))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==r:null===r)?o["string"==typeof e?"string":"hash"]:o.map}function et(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}et.prototype.clear=function(){this.size=0,this.__data__={hash:new V,map:new(X||K),string:new V}},et.prototype.delete=function(t){var e=tt(this,t).delete(t);return this.size-=e?1:0,e},et.prototype.get=function(t){return tt(this,t).get(t)},et.prototype.has=function(t){return tt(this,t).has(t)},et.prototype.set=function(t,e){var r=tt(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this};var rt="Expected a function";function nt(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new TypeError(rt);var r=function(){var n=arguments,o=e?e.apply(this,n):n[0],i=r.cache;if(i.has(o))return i.get(o);var u=t.apply(this,n);return r.cache=i.set(o,u)||i,u};return r.cache=new(nt.Cache||et),r}nt.Cache=et;var ot,it,ut,at=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,ct=/\\(\\)?/g,st=(ot=function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(at,(function(t,r,n,o){e.push(n?o.replace(ct,"$1"):r||t)})),e},it=nt(ot,(function(t){return 500===ut.size&&ut.clear(),t})),ut=it.cache,it),ft=st;function lt(t,e){for(var r=-1,n=null==t?0:t.length,o=Array(n);++r<n;)o[r]=e(t[r],r,t);return o}var pt=1/0,ht=f?f.prototype:void 0,vt=ht?ht.toString:void 0;function dt(t){if("string"==typeof t)return t;if(u(t))return lt(t,dt)+"";if(_(t))return vt?vt.call(t):"";var e=t+"";return"0"==e&&1/t==-pt?"-0":e}function yt(t){return null==t?"":dt(t)}function bt(t,e){return u(t)?t:A(t,e)?[t]:ft(yt(t))}var gt=1/0;function mt(t){if("string"==typeof t||_(t))return t;var e=t+"";return"0"==e&&1/t==-gt?"-0":e}function jt(t,e){for(var r=0,n=(e=bt(e,t)).length;null!=t&&r<n;)t=t[mt(e[r++])];return r&&r==n?t:void 0}function wt(t,e,r){var n=null==t?void 0:jt(t,e);return void 0===n?r:n}function _t(t){return"[object Array]"===Object.prototype.toString.call(t)}function Ot(t){return"[object Undefined]"===Object.prototype.toString.call(t)}function St(t){return"[object Object]"===Object.prototype.toString.call(t)}function At(t){if(St(t)){for(let e in t)return!1;return!0}return!1}function xt(t){return"[object String]"===Object.prototype.toString.call(t)}function $t(t){return t!=t}function Mt(t){return!!Ot(t)||(!!function(t){return"[object Null]"===Object.prototype.toString.call(t)}(t)||(!!At(t)||(!!function(t){return!(!xt(t)||""!==t)}(t)||(!!function(t){return!!_t(t)&&0===t.length}(t)||!!$t(t)))))}function Tt(t){return!!_t(t)&&(0!==t.length&&(1!==t.length||!Mt(t[0])))}var Dt="[object Boolean]";function kt(t){return!0===(e=t)||!1===e||j(e)&&m(e)==Dt;var e}var Ut=/\s/;var Nt=/^\s+/;function Bt(t){return t?t.slice(0,function(t){for(var e=t.length;e--&&Ut.test(t.charAt(e)););return e}(t)+1).replace(Nt,""):t}var Ct=NaN,Et=/^[-+]0x[0-9a-f]+$/i,It=/^0b[01]+$/i,Ft=/^0o[0-7]+$/i,Pt=parseInt;function zt(t){if("number"==typeof t)return t;if(_(t))return Ct;if(x(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=x(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=Bt(t);var r=It.test(t);return r||Ft.test(t)?Pt(t.slice(2),r?2:8):Et.test(t)?Ct:+t}var Rt=1/0,Wt=17976931348623157e292;function Lt(t){return t?(t=zt(t))===Rt||t===-Rt?(t<0?-1:1)*Wt:t==t?t:0:0===t?t:0}function Ht(t){var e=Lt(t),r=e%1;return e==e?r?e-r:e:0}function Yt(t){return!(!xt(t)||""===t)}function qt(t){let e=!1;if(Yt(t))e=!isNaN(Number(t));else if(function(t){return"[object Number]"===Object.prototype.toString.call(t)}(t)){if($t(t))return!1;e=!0}return e}function Jt(t){if(!qt(t))return 0;return Lt(t)}function Vt(t){return!!qt(t)&&(t=Jt(t),"number"==typeof(e=t)&&e==Ht(e));var e}var Gt="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},Zt={};!function(t){var e=Object.prototype.hasOwnProperty,r="~";function n(){}function o(t,e,r){this.fn=t,this.context=e,this.once=r||!1}function i(t,e,n,i,u){if("function"!=typeof n)throw new TypeError("The listener must be a function");var a=new o(n,i||t,u),c=r?r+e:e;return t._events[c]?t._events[c].fn?t._events[c]=[t._events[c],a]:t._events[c].push(a):(t._events[c]=a,t._eventsCount++),t}function u(t,e){0==--t._eventsCount?t._events=new n:delete t._events[e]}function a(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(r=!1)),a.prototype.eventNames=function(){var t,n,o=[];if(0===this._eventsCount)return o;for(n in t=this._events)e.call(t,n)&&o.push(r?n.slice(1):n);return Object.getOwnPropertySymbols?o.concat(Object.getOwnPropertySymbols(t)):o},a.prototype.listeners=function(t){var e=r?r+t:t,n=this._events[e];if(!n)return[];if(n.fn)return[n.fn];for(var o=0,i=n.length,u=new Array(i);o<i;o++)u[o]=n[o].fn;return u},a.prototype.listenerCount=function(t){var e=r?r+t:t,n=this._events[e];return n?n.fn?1:n.length:0},a.prototype.emit=function(t,e,n,o,i,u){var a=r?r+t:t;if(!this._events[a])return!1;var c,s,f=this._events[a],l=arguments.length;if(f.fn){switch(f.once&&this.removeListener(t,f.fn,void 0,!0),l){case 1:return f.fn.call(f.context),!0;case 2:return f.fn.call(f.context,e),!0;case 3:return f.fn.call(f.context,e,n),!0;case 4:return f.fn.call(f.context,e,n,o),!0;case 5:return f.fn.call(f.context,e,n,o,i),!0;case 6:return f.fn.call(f.context,e,n,o,i,u),!0}for(s=1,c=new Array(l-1);s<l;s++)c[s-1]=arguments[s];f.fn.apply(f.context,c)}else{var p,h=f.length;for(s=0;s<h;s++)switch(f[s].once&&this.removeListener(t,f[s].fn,void 0,!0),l){case 1:f[s].fn.call(f[s].context);break;case 2:f[s].fn.call(f[s].context,e);break;case 3:f[s].fn.call(f[s].context,e,n);break;case 4:f[s].fn.call(f[s].context,e,n,o);break;default:if(!c)for(p=1,c=new Array(l-1);p<l;p++)c[p-1]=arguments[p];f[s].fn.apply(f[s].context,c)}}return!0},a.prototype.on=function(t,e,r){return i(this,t,e,r,!1)},a.prototype.once=function(t,e,r){return i(this,t,e,r,!0)},a.prototype.removeListener=function(t,e,n,o){var i=r?r+t:t;if(!this._events[i])return this;if(!e)return u(this,i),this;var a=this._events[i];if(a.fn)a.fn!==e||o&&!a.once||n&&a.context!==n||u(this,i);else{for(var c=0,s=[],f=a.length;c<f;c++)(a[c].fn!==e||o&&!a[c].once||n&&a[c].context!==n)&&s.push(a[c]);s.length?this._events[i]=1===s.length?s[0]:s:u(this,i)}return this},a.prototype.removeAllListeners=function(t){var e;return t?(e=r?r+t:t,this._events[e]&&u(this,e)):(this._events=new n,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=r,a.EventEmitter=a,t.exports=a}({get exports(){return Zt},set exports(t){Zt=t}});var Qt=Zt;function Kt(){return new Qt}function Xt(t){var e=this.__data__=new K(t);this.size=e.size}Xt.prototype.clear=function(){this.__data__=new K,this.size=0},Xt.prototype.delete=function(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r},Xt.prototype.get=function(t){return this.__data__.get(t)},Xt.prototype.has=function(t){return this.__data__.has(t)},Xt.prototype.set=function(t,e){var r=this.__data__;if(r instanceof K){var n=r.__data__;if(!X||n.length<199)return n.push([t,e]),this.size=++r.size,this;r=this.__data__=new et(n)}return r.set(t,e),this.size=r.size,this};function te(t){var e=-1,r=null==t?0:t.length;for(this.__data__=new et;++e<r;)this.add(t[e])}function ee(t,e){for(var r=-1,n=null==t?0:t.length;++r<n;)if(e(t[r],r,t))return!0;return!1}function re(t,e){return t.has(e)}te.prototype.add=te.prototype.push=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this},te.prototype.has=function(t){return this.__data__.has(t)};var ne=1,oe=2;function ie(t,e,r,n,o,i){var u=r&ne,a=t.length,c=e.length;if(a!=c&&!(u&&c>a))return!1;var s=i.get(t),f=i.get(e);if(s&&f)return s==e&&f==t;var l=-1,p=!0,h=r&oe?new te:void 0;for(i.set(t,e),i.set(e,t);++l<a;){var v=t[l],d=e[l];if(n)var y=u?n(d,v,l,e,t,i):n(v,d,l,t,e,i);if(void 0!==y){if(y)continue;p=!1;break}if(h){if(!ee(e,(function(t,e){if(!re(h,e)&&(v===t||o(v,t,r,n,i)))return h.push(e)}))){p=!1;break}}else if(v!==d&&!o(v,d,r,n,i)){p=!1;break}}return i.delete(t),i.delete(e),p}var ue=s.Uint8Array;function ae(t){var e=-1,r=Array(t.size);return t.forEach((function(t,n){r[++e]=[n,t]})),r}function ce(t){var e=-1,r=Array(t.size);return t.forEach((function(t){r[++e]=t})),r}var se=1,fe=2,le="[object Boolean]",pe="[object Date]",he="[object Error]",ve="[object Map]",de="[object Number]",ye="[object RegExp]",be="[object Set]",ge="[object String]",me="[object Symbol]",je="[object ArrayBuffer]",we="[object DataView]",_e=f?f.prototype:void 0,Oe=_e?_e.valueOf:void 0;function Se(t,e){for(var r=-1,n=e.length,o=t.length;++r<n;)t[o+r]=e[r];return t}function Ae(t,e,r){var n=e(t);return u(t)?n:Se(n,r(t))}function xe(){return[]}var $e=Object.prototype.propertyIsEnumerable,Me=Object.getOwnPropertySymbols,Te=Me?function(t){return null==t?[]:(t=Object(t),function(t,e){for(var r=-1,n=null==t?0:t.length,o=0,i=[];++r<n;){var u=t[r];e(u,r,t)&&(i[o++]=u)}return i}(Me(t),(function(e){return $e.call(t,e)})))}:xe,De=Te;function ke(t){return j(t)&&"[object Arguments]"==m(t)}var Ue=Object.prototype,Ne=Ue.hasOwnProperty,Be=Ue.propertyIsEnumerable,Ce=ke(function(){return arguments}())?ke:function(t){return j(t)&&Ne.call(t,"callee")&&!Be.call(t,"callee")},Ee=Ce;var Ie="object"==typeof exports&&exports&&!exports.nodeType&&exports,Fe=Ie&&"object"==typeof module&&module&&!module.nodeType&&module,Pe=Fe&&Fe.exports===Ie?s.Buffer:void 0,ze=(Pe?Pe.isBuffer:void 0)||function(){return!1},Re=9007199254740991,We=/^(?:0|[1-9]\d*)$/;function Le(t,e){var r=typeof t;return!!(e=null==e?Re:e)&&("number"==r||"symbol"!=r&&We.test(t))&&t>-1&&t%1==0&&t<e}var He=9007199254740991;function Ye(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=He}var qe={};function Je(t){return function(e){return t(e)}}qe["[object Float32Array]"]=qe["[object Float64Array]"]=qe["[object Int8Array]"]=qe["[object Int16Array]"]=qe["[object Int32Array]"]=qe["[object Uint8Array]"]=qe["[object Uint8ClampedArray]"]=qe["[object Uint16Array]"]=qe["[object Uint32Array]"]=!0,qe["[object Arguments]"]=qe["[object Array]"]=qe["[object ArrayBuffer]"]=qe["[object Boolean]"]=qe["[object DataView]"]=qe["[object Date]"]=qe["[object Error]"]=qe["[object Function]"]=qe["[object Map]"]=qe["[object Number]"]=qe["[object Object]"]=qe["[object RegExp]"]=qe["[object Set]"]=qe["[object String]"]=qe["[object WeakMap]"]=!1;var Ve="object"==typeof exports&&exports&&!exports.nodeType&&exports,Ge=Ve&&"object"==typeof module&&module&&!module.nodeType&&module,Ze=Ge&&Ge.exports===Ve&&a.process,Qe=function(){try{var t=Ge&&Ge.require&&Ge.require("util").types;return t||Ze&&Ze.binding&&Ze.binding("util")}catch(t){}}(),Ke=Qe&&Qe.isTypedArray,Xe=Ke?Je(Ke):function(t){return j(t)&&Ye(t.length)&&!!qe[m(t)]},tr=Object.prototype.hasOwnProperty;function er(t,e){var r=u(t),n=!r&&Ee(t),o=!r&&!n&&ze(t),i=!r&&!n&&!o&&Xe(t),a=r||n||o||i,c=a?function(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n}(t.length,String):[],s=c.length;for(var f in t)!e&&!tr.call(t,f)||a&&("length"==f||o&&("offset"==f||"parent"==f)||i&&("buffer"==f||"byteLength"==f||"byteOffset"==f)||Le(f,s))||c.push(f);return c}var rr=Object.prototype;function nr(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||rr)}function or(t,e){return function(r){return t(e(r))}}var ir=or(Object.keys,Object),ur=Object.prototype.hasOwnProperty;function ar(t){if(!nr(t))return ir(t);var e=[];for(var r in Object(t))ur.call(t,r)&&"constructor"!=r&&e.push(r);return e}function cr(t){return null!=t&&Ye(t.length)&&!k(t)}function sr(t){return cr(t)?er(t):ar(t)}function fr(t){return Ae(t,sr,De)}var lr=1,pr=Object.prototype.hasOwnProperty;var hr=H(s,"DataView"),vr=H(s,"Promise"),dr=H(s,"Set"),yr=H(s,"WeakMap"),br="[object Map]",gr="[object Promise]",mr="[object Set]",jr="[object WeakMap]",wr="[object DataView]",_r=E(hr),Or=E(X),Sr=E(vr),Ar=E(dr),xr=E(yr),$r=m;(hr&&$r(new hr(new ArrayBuffer(1)))!=wr||X&&$r(new X)!=br||vr&&$r(vr.resolve())!=gr||dr&&$r(new dr)!=mr||yr&&$r(new yr)!=jr)&&($r=function(t){var e=m(t),r="[object Object]"==e?t.constructor:void 0,n=r?E(r):"";if(n)switch(n){case _r:return wr;case Or:return br;case Sr:return gr;case Ar:return mr;case xr:return jr}return e});var Mr=$r,Tr=1,Dr="[object Arguments]",kr="[object Array]",Ur="[object Object]",Nr=Object.prototype.hasOwnProperty;function Br(t,e,r,n,o,i){var a=u(t),c=u(e),s=a?kr:Mr(t),f=c?kr:Mr(e),l=(s=s==Dr?Ur:s)==Ur,p=(f=f==Dr?Ur:f)==Ur,h=s==f;if(h&&ze(t)){if(!ze(e))return!1;a=!0,l=!1}if(h&&!l)return i||(i=new Xt),a||Xe(t)?ie(t,e,r,n,o,i):function(t,e,r,n,o,i,u){switch(r){case we:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case je:return!(t.byteLength!=e.byteLength||!i(new ue(t),new ue(e)));case le:case pe:case de:return G(+t,+e);case he:return t.name==e.name&&t.message==e.message;case ye:case ge:return t==e+"";case ve:var a=ae;case be:var c=n&se;if(a||(a=ce),t.size!=e.size&&!c)return!1;var s=u.get(t);if(s)return s==e;n|=fe,u.set(t,e);var f=ie(a(t),a(e),n,o,i,u);return u.delete(t),f;case me:if(Oe)return Oe.call(t)==Oe.call(e)}return!1}(t,e,s,r,n,o,i);if(!(r&Tr)){var v=l&&Nr.call(t,"__wrapped__"),d=p&&Nr.call(e,"__wrapped__");if(v||d){var y=v?t.value():t,b=d?e.value():e;return i||(i=new Xt),o(y,b,r,n,i)}}return!!h&&(i||(i=new Xt),function(t,e,r,n,o,i){var u=r&lr,a=fr(t),c=a.length;if(c!=fr(e).length&&!u)return!1;for(var s=c;s--;){var f=a[s];if(!(u?f in e:pr.call(e,f)))return!1}var l=i.get(t),p=i.get(e);if(l&&p)return l==e&&p==t;var h=!0;i.set(t,e),i.set(e,t);for(var v=u;++s<c;){var d=t[f=a[s]],y=e[f];if(n)var b=u?n(y,d,f,e,t,i):n(d,y,f,t,e,i);if(!(void 0===b?d===y||o(d,y,r,n,i):b)){h=!1;break}v||(v="constructor"==f)}if(h&&!v){var g=t.constructor,m=e.constructor;g==m||!("constructor"in t)||!("constructor"in e)||"function"==typeof g&&g instanceof g&&"function"==typeof m&&m instanceof m||(h=!1)}return i.delete(t),i.delete(e),h}(t,e,r,n,o,i))}function Cr(t,e,r,n,o){return t===e||(null==t||null==e||!j(t)&&!j(e)?t!=t&&e!=e:Br(t,e,r,n,Cr,o))}var Er=1,Ir=2;function Fr(t){return t==t&&!x(t)}function Pr(t,e){return function(r){return null!=r&&(r[t]===e&&(void 0!==e||t in Object(r)))}}function zr(t){var e=function(t){for(var e=sr(t),r=e.length;r--;){var n=e[r],o=t[n];e[r]=[n,o,Fr(o)]}return e}(t);return 1==e.length&&e[0][2]?Pr(e[0][0],e[0][1]):function(r){return r===t||function(t,e,r,n){var o=r.length,i=o,u=!n;if(null==t)return!i;for(t=Object(t);o--;){var a=r[o];if(u&&a[2]?a[1]!==t[a[0]]:!(a[0]in t))return!1}for(;++o<i;){var c=(a=r[o])[0],s=t[c],f=a[1];if(u&&a[2]){if(void 0===s&&!(c in t))return!1}else{var l=new Xt;if(n)var p=n(s,f,c,t,e,l);if(!(void 0===p?Cr(f,s,Er|Ir,n,l):p))return!1}}return!0}(r,t,e)}}function Rr(t,e){return null!=t&&e in Object(t)}function Wr(t,e){return null!=t&&function(t,e,r){for(var n=-1,o=(e=bt(e,t)).length,i=!1;++n<o;){var a=mt(e[n]);if(!(i=null!=t&&r(t,a)))break;t=t[a]}return i||++n!=o?i:!!(o=null==t?0:t.length)&&Ye(o)&&Le(a,o)&&(u(t)||Ee(t))}(t,e,Rr)}var Lr=1,Hr=2;function Yr(t){return t}function qr(t){return function(e){return null==e?void 0:e[t]}}function Jr(t){return A(t)?qr(mt(t)):function(t){return function(e){return jt(e,t)}}(t)}function Vr(t){return"function"==typeof t?t:null==t?Yr:"object"==typeof t?u(t)?function(t,e){return A(t)&&Fr(e)?Pr(mt(t),e):function(r){var n=wt(r,t);return void 0===n&&n===e?Wr(r,t):Cr(e,n,Lr|Hr)}}(t[0],t[1]):zr(t):Jr(t)}var Gr,Zr=function(t,e,r){for(var n=-1,o=Object(t),i=r(t),u=i.length;u--;){var a=i[Gr?u:++n];if(!1===e(o[a],a,o))break}return t};var Qr=function(t,e){return function(r,n){if(null==r)return r;if(!cr(r))return t(r,n);for(var o=r.length,i=e?o:-1,u=Object(r);(e?i--:++i<o)&&!1!==n(u[i],i,u););return r}}((function(t,e){return t&&Zr(t,e,sr)})),Kr=Qr;function Xr(t,e){var r=-1,n=cr(t)?Array(t.length):[];return Kr(t,(function(t,o,i){n[++r]=e(t,o,i)})),n}function tn(t,e){for(var r=-1,n=null==t?0:t.length;++r<n&&!1!==e(t[r],r,t););return t}function en(t,e){var r;return(u(t)?tn:Kr)(t,"function"==typeof(r=e)?r:Yr)}var rn=function(){try{var t=H(Object,"defineProperty");return t({},"",{}),t}catch(t){}}(),nn=rn;function on(t,e,r){"__proto__"==e&&nn?nn(t,e,{configurable:!0,enumerable:!0,value:r,writable:!0}):t[e]=r}var un=Object.prototype.hasOwnProperty;function an(t,e,r){var n=t[e];un.call(t,e)&&G(n,r)&&(void 0!==r||e in t)||on(t,e,r)}function cn(t,e,r,n){var o=!r;r||(r={});for(var i=-1,u=e.length;++i<u;){var a=e[i],c=n?n(r[a],t[a],a,r,t):void 0;void 0===c&&(c=t[a]),o?on(r,a,c):an(r,a,c)}return r}var sn=Object.prototype.hasOwnProperty;function fn(t){if(!x(t))return function(t){var e=[];if(null!=t)for(var r in Object(t))e.push(r);return e}(t);var e=nr(t),r=[];for(var n in t)("constructor"!=n||!e&&sn.call(t,n))&&r.push(n);return r}function ln(t){return cr(t)?er(t,!0):fn(t)}var pn="object"==typeof exports&&exports&&!exports.nodeType&&exports,hn=pn&&"object"==typeof module&&module&&!module.nodeType&&module,vn=hn&&hn.exports===pn?s.Buffer:void 0,dn=vn?vn.allocUnsafe:void 0;function yn(t,e){if(e)return t.slice();var r=t.length,n=dn?dn(r):new t.constructor(r);return t.copy(n),n}function bn(t,e){var r=-1,n=t.length;for(e||(e=Array(n));++r<n;)e[r]=t[r];return e}var gn=or(Object.getPrototypeOf,Object),mn=Object.getOwnPropertySymbols?function(t){for(var e=[];t;)Se(e,De(t)),t=gn(t);return e}:xe,jn=mn;function wn(t){return Ae(t,ln,jn)}var _n=Object.prototype.hasOwnProperty;function On(t){var e=new t.constructor(t.byteLength);return new ue(e).set(new ue(t)),e}var Sn=/\w*$/;var An=f?f.prototype:void 0,xn=An?An.valueOf:void 0;function $n(t,e){var r=e?On(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.length)}var Mn="[object Boolean]",Tn="[object Date]",Dn="[object Map]",kn="[object Number]",Un="[object RegExp]",Nn="[object Set]",Bn="[object String]",Cn="[object Symbol]",En="[object ArrayBuffer]",In="[object DataView]",Fn="[object Float32Array]",Pn="[object Float64Array]",zn="[object Int8Array]",Rn="[object Int16Array]",Wn="[object Int32Array]",Ln="[object Uint8Array]",Hn="[object Uint8ClampedArray]",Yn="[object Uint16Array]",qn="[object Uint32Array]";function Jn(t,e,r){var n,o=t.constructor;switch(e){case En:return On(t);case Mn:case Tn:return new o(+t);case In:return function(t,e){var r=e?On(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.byteLength)}(t,r);case Fn:case Pn:case zn:case Rn:case Wn:case Ln:case Hn:case Yn:case qn:return $n(t,r);case Dn:return new o;case kn:case Bn:return new o(t);case Un:return function(t){var e=new t.constructor(t.source,Sn.exec(t));return e.lastIndex=t.lastIndex,e}(t);case Nn:return new o;case Cn:return n=t,xn?Object(xn.call(n)):{}}}var Vn=Object.create,Gn=function(){function t(){}return function(e){if(!x(e))return{};if(Vn)return Vn(e);t.prototype=e;var r=new t;return t.prototype=void 0,r}}(),Zn=Gn;function Qn(t){return"function"!=typeof t.constructor||nr(t)?{}:Zn(gn(t))}var Kn=Qe&&Qe.isMap,Xn=Kn?Je(Kn):function(t){return j(t)&&"[object Map]"==Mr(t)};var to=Qe&&Qe.isSet,eo=to?Je(to):function(t){return j(t)&&"[object Set]"==Mr(t)},ro=1,no=2,oo=4,io="[object Arguments]",uo="[object Function]",ao="[object GeneratorFunction]",co="[object Object]",so={};function fo(t,e,r,n,o,i){var a,c=e&ro,s=e&no,f=e&oo;if(r&&(a=o?r(t,n,o,i):r(t)),void 0!==a)return a;if(!x(t))return t;var l=u(t);if(l){if(a=function(t){var e=t.length,r=new t.constructor(e);return e&&"string"==typeof t[0]&&_n.call(t,"index")&&(r.index=t.index,r.input=t.input),r}(t),!c)return bn(t,a)}else{var p=Mr(t),h=p==uo||p==ao;if(ze(t))return yn(t,c);if(p==co||p==io||h&&!o){if(a=s||h?{}:Qn(t),!c)return s?function(t,e){return cn(t,jn(t),e)}(t,function(t,e){return t&&cn(e,ln(e),t)}(a,t)):function(t,e){return cn(t,De(t),e)}(t,function(t,e){return t&&cn(e,sr(e),t)}(a,t))}else{if(!so[p])return o?t:{};a=Jn(t,p,c)}}i||(i=new Xt);var v=i.get(t);if(v)return v;i.set(t,a),eo(t)?t.forEach((function(n){a.add(fo(n,e,r,n,t,i))})):Xn(t)&&t.forEach((function(n,o){a.set(o,fo(n,e,r,o,t,i))}));var d=l?void 0:(f?s?wn:fr:s?ln:sr)(t);return tn(d||t,(function(n,o){d&&(n=t[o=n]),an(a,o,fo(n,e,r,o,t,i))})),a}so[io]=so["[object Array]"]=so["[object ArrayBuffer]"]=so["[object DataView]"]=so["[object Boolean]"]=so["[object Date]"]=so["[object Float32Array]"]=so["[object Float64Array]"]=so["[object Int8Array]"]=so["[object Int16Array]"]=so["[object Int32Array]"]=so["[object Map]"]=so["[object Number]"]=so[co]=so["[object RegExp]"]=so["[object Set]"]=so["[object String]"]=so["[object Symbol]"]=so["[object Uint8Array]"]=so["[object Uint8ClampedArray]"]=so["[object Uint16Array]"]=so["[object Uint32Array]"]=!0,so["[object Error]"]=so[uo]=so["[object WeakMap]"]=!1;var lo=1,po=4;function ho(t){return fo(t,lo|po)}function vo(){let t,e,r=new Promise((function(){t=arguments[0],e=arguments[1]}));return r.resolve=t,r.reject=e,r}var yo="[object String]";var bo=qr("length"),go=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]");var mo="\\ud800-\\udfff",jo="["+mo+"]",wo="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",_o="\\ud83c[\\udffb-\\udfff]",Oo="[^"+mo+"]",So="(?:\\ud83c[\\udde6-\\uddff]){2}",Ao="[\\ud800-\\udbff][\\udc00-\\udfff]",xo="(?:"+wo+"|"+_o+")"+"?",$o="[\\ufe0e\\ufe0f]?",Mo=$o+xo+("(?:\\u200d(?:"+[Oo,So,Ao].join("|")+")"+$o+xo+")*"),To="(?:"+[Oo+wo+"?",wo,So,Ao,jo].join("|")+")",Do=RegExp(_o+"(?="+_o+")|"+To+Mo,"g");function ko(t){return function(t){return go.test(t)}(t)?function(t){for(var e=Do.lastIndex=0;Do.test(t);)++e;return e}(t):bo(t)}var Uo="[object Map]",No="[object Set]";function Bo(t){if(null==t)return 0;if(cr(t))return"string"==typeof(e=t)||!u(e)&&j(e)&&m(e)==yo?ko(t):t.length;var e,r=Mr(t);return r==Uo||r==No?t.size:ar(t).length}var Co=s.isFinite,Eo=Math.min;var Io=function(t){var e=Math[t];return function(t,r){if(t=zt(t),(r=null==r?0:Eo(Ht(r),292))&&Co(t)){var n=(yt(t)+"e").split("e");return+((n=(yt(e(n[0]+"e"+(+n[1]+r)))+"e").split("e"))[0]+"e"+(+n[1]-r))}return e(t)}}("round"),Fo=Io;function Po(t){if(!qt(t))return 0;t=Jt(t);let e=Fo(t);return"0"===String(e)?0:e}function zo(t){if(!Vt(t))return!1;return Po(t)>0}function Ro(t){if(St(t)){for(let e in t)return!0;return!1}return!1}function Wo(t,e){return!!St(t)&&(!(!Yt(e)&&!qt(e))&&e in t)}function Lo(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=Kt(),r={},n=null,o=wt(t,"timeAlive");zo(o)||(o=1e4),o=Po(o);let i=wt(t,"timeDetect");return zo(i)||(i=50),i=Po(i),e.trigger=function(t,u){Yt(t)?(Wo(r,t)||setTimeout((()=>{e.emit("message",{eventName:"enter",key:t,data:u,now:Bo(r)})}),1),r[t]={data:u,time:Date.now()},null===n&&(n=setInterval((()=>{en(r,((t,n)=>{if(Date.now()-t.time>o){let t=ho(r[n]);delete r[n],e.emit("message",{eventName:"leave",key:n,data:t.data,now:Bo(r)})}})),Ro(r)||(clearInterval(n),n=null)}),i))):console.log("trigger need key")},e.get=function(){let t=[];return en(r,((e,r)=>{t.push({key:r,data:e.data})})),t=ho(t),t},e}function Ho(t){return"[object ArrayBuffer]"===Object.prototype.toString.call(t)}function Yo(t){return"[object Uint8Array]"===Object.prototype.toString.call(t)}function qo(t){return"[object Uint16Array]"===Object.prototype.toString.call(t)}function Jo(t){if(!(Ho(t)||(e=t,"[object Blob]"===Object.prototype.toString.call(e))||Yo(t)||qo(t)))return null;var e;try{if(t.byteLength)return t.byteLength}catch(t){}try{if(t.length)return t.length}catch(t){}try{if(t.size)return t.size}catch(t){}return null}var Vo="[object Object]",Go=Function.prototype,Zo=Object.prototype,Qo=Go.toString,Ko=Zo.hasOwnProperty,Xo=Qo.call(Object);function ti(t){if(!j(t)||m(t)!=Vo)return!1;var e=gn(t);if(null===e)return!0;var r=Ko.call(e,"constructor")&&e.constructor;return"function"==typeof r&&r instanceof r&&Qo.call(r)==Xo}var ei="[object DOMException]",ri="[object Error]";function ni(t){if(!St(t))return{results:"",binarys:[]};if(At(t))return{results:"",binarys:[]};let e="",r=[];try{let n=-1;e=JSON.stringify(t,(function(t,e){if(Yo(e)){n+=1;let t=`[Uint8Array]::${n}`;return r.push(e),t}if(qo(e)){n+=1;let t=`[Uint16Array]::${n}`;return r.push(e),t}if(Ho(e)){n+=1;let t=`[ArrayBuffer]::${n}`;return r.push(e),t}return function(t){if(!j(t))return!1;var e=m(t);return e==ri||e==ei||"string"==typeof t.message&&"string"==typeof t.name&&!ti(t)}(e)&&(e=e.toString()),e}))}catch(t){}return{results:e,binarys:r}}var oi={};var ii,ui={},ai={get exports(){return ui},set exports(t){ui=t}};function ci(){return ii||(ii=1,function(t,e){var r;t.exports=(r=r||function(t,e){var r;if("undefined"!=typeof window&&window.crypto&&(r=window.crypto),"undefined"!=typeof self&&self.crypto&&(r=self.crypto),"undefined"!=typeof globalThis&&globalThis.crypto&&(r=globalThis.crypto),!r&&"undefined"!=typeof window&&window.msCrypto&&(r=window.msCrypto),!r&&void 0!==Gt&&Gt.crypto&&(r=Gt.crypto),!r)try{r=require("crypto")}catch(t){}var n=function(){if(r){if("function"==typeof r.getRandomValues)try{return r.getRandomValues(new Uint32Array(1))[0]}catch(t){}if("function"==typeof r.randomBytes)try{return r.randomBytes(4).readInt32LE()}catch(t){}}throw new Error("Native crypto module could not be used to get secure random number.")},o=Object.create||function(){function t(){}return function(e){var r;return t.prototype=e,r=new t,t.prototype=null,r}}(),i={},u=i.lib={},a=u.Base={extend:function(t){var e=o(this);return t&&e.mixIn(t),e.hasOwnProperty("init")&&this.init!==e.init||(e.init=function(){e.$super.init.apply(this,arguments)}),e.init.prototype=e,e.$super=this,e},create:function(){var t=this.extend();return t.init.apply(t,arguments),t},init:function(){},mixIn:function(t){for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);t.hasOwnProperty("toString")&&(this.toString=t.toString)},clone:function(){return this.init.prototype.extend(this)}},c=u.WordArray=a.extend({init:function(t,r){t=this.words=t||[],this.sigBytes=r!=e?r:4*t.length},toString:function(t){return(t||f).stringify(this)},concat:function(t){var e=this.words,r=t.words,n=this.sigBytes,o=t.sigBytes;if(this.clamp(),n%4)for(var i=0;i<o;i++){var u=r[i>>>2]>>>24-i%4*8&255;e[n+i>>>2]|=u<<24-(n+i)%4*8}else for(var a=0;a<o;a+=4)e[n+a>>>2]=r[a>>>2];return this.sigBytes+=o,this},clamp:function(){var e=this.words,r=this.sigBytes;e[r>>>2]&=4294967295<<32-r%4*8,e.length=t.ceil(r/4)},clone:function(){var t=a.clone.call(this);return t.words=this.words.slice(0),t},random:function(t){for(var e=[],r=0;r<t;r+=4)e.push(n());return new c.init(e,t)}}),s=i.enc={},f=s.Hex={stringify:function(t){for(var e=t.words,r=t.sigBytes,n=[],o=0;o<r;o++){var i=e[o>>>2]>>>24-o%4*8&255;n.push((i>>>4).toString(16)),n.push((15&i).toString(16))}return n.join("")},parse:function(t){for(var e=t.length,r=[],n=0;n<e;n+=2)r[n>>>3]|=parseInt(t.substr(n,2),16)<<24-n%8*4;return new c.init(r,e/2)}},l=s.Latin1={stringify:function(t){for(var e=t.words,r=t.sigBytes,n=[],o=0;o<r;o++){var i=e[o>>>2]>>>24-o%4*8&255;n.push(String.fromCharCode(i))}return n.join("")},parse:function(t){for(var e=t.length,r=[],n=0;n<e;n++)r[n>>>2]|=(255&t.charCodeAt(n))<<24-n%4*8;return new c.init(r,e)}},p=s.Utf8={stringify:function(t){try{return decodeURIComponent(escape(l.stringify(t)))}catch(t){throw new Error("Malformed UTF-8 data")}},parse:function(t){return l.parse(unescape(encodeURIComponent(t)))}},h=u.BufferedBlockAlgorithm=a.extend({reset:function(){this._data=new c.init,this._nDataBytes=0},_append:function(t){"string"==typeof t&&(t=p.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes},_process:function(e){var r,n=this._data,o=n.words,i=n.sigBytes,u=this.blockSize,a=i/(4*u),s=(a=e?t.ceil(a):t.max((0|a)-this._minBufferSize,0))*u,f=t.min(4*s,i);if(s){for(var l=0;l<s;l+=u)this._doProcessBlock(o,l);r=o.splice(0,s),n.sigBytes-=f}return new c.init(r,f)},clone:function(){var t=a.clone.call(this);return t._data=this._data.clone(),t},_minBufferSize:0});u.Hasher=h.extend({cfg:a.extend(),init:function(t){this.cfg=this.cfg.extend(t),this.reset()},reset:function(){h.reset.call(this),this._doReset()},update:function(t){return this._append(t),this._process(),this},finalize:function(t){return t&&this._append(t),this._doFinalize()},blockSize:16,_createHelper:function(t){return function(e,r){return new t.init(r).finalize(e)}},_createHmacHelper:function(t){return function(e,r){return new v.HMAC.init(t,r).finalize(e)}}});var v=i.algo={};return i}(Math),r)}(ai)),ui}!function(t,e){t.exports=ci().enc.Utf8}({get exports(){return oi},set exports(t){oi=t}});var si=oi,fi={};!function(t,e){var r;t.exports=(r=ci(),function(){var t=r,e=t.lib.WordArray;function n(t,r,n){for(var o=[],i=0,u=0;u<r;u++)if(u%4){var a=n[t.charCodeAt(u-1)]<<u%4*2|n[t.charCodeAt(u)]>>>6-u%4*2;o[i>>>2]|=a<<24-i%4*8,i++}return e.create(o,i)}t.enc.Base64={stringify:function(t){var e=t.words,r=t.sigBytes,n=this._map;t.clamp();for(var o=[],i=0;i<r;i+=3)for(var u=(e[i>>>2]>>>24-i%4*8&255)<<16|(e[i+1>>>2]>>>24-(i+1)%4*8&255)<<8|e[i+2>>>2]>>>24-(i+2)%4*8&255,a=0;a<4&&i+.75*a<r;a++)o.push(n.charAt(u>>>6*(3-a)&63));var c=n.charAt(64);if(c)for(;o.length%4;)o.push(c);return o.join("")},parse:function(t){var e=t.length,r=this._map,o=this._reverseMap;if(!o){o=this._reverseMap=[];for(var i=0;i<r.length;i++)o[r.charCodeAt(i)]=i}var u=r.charAt(64);if(u){var a=t.indexOf(u);-1!==a&&(e=a)}return n(t,e,o)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),r.enc.Base64)}({get exports(){return fi},set exports(t){fi=t}});var li=fi;function pi(t){if(!Yt(t))return new Uint8Array;let e;try{e=function(t){if(!xt(t))return new Uint8Array;let e=li.parse(t),r=e.words,n=e.sigBytes,o=new Uint8Array(n);for(let t=0;t<n;t++){let e=r[t>>>2]>>>24-t%4*8&255;o[t]=e}return o}(function(t){if(!Yt(t))return"";let e=si.parse(t);return li.stringify(e)}(t))}catch(t){return new Uint8Array}return e}function hi(t,e){return function(t,e,r,n,o,i){if(!qt(t))return null;if(!Yo(e))return null;if(!Vt(r))return null;if(!kt(n))return null;if(!Vt(o))return null;if(!Vt(i))return null;let u,a,c;t=Jt(t);let s=8*i-o-1,f=(1<<s)-1,l=f>>1,p=23===o?Math.pow(2,-24)-Math.pow(2,-77):0,h=n?i-1:0,v=n?-1:1,d=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,u=f):(u=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-u))<1&&(u--,c*=2),(t+=u+l>=1?p/c:p*Math.pow(2,1-l))*c>=2&&(u++,c/=2),u+l>=f?(a=0,u=f):u+l>=1?(a=(t*c-1)*Math.pow(2,o),u+=l):(a=t*Math.pow(2,l-1)*Math.pow(2,o),u=0));o>=8;e[r+h]=255&a,h+=v,a/=256,o-=8);for(u=u<<o|a,s+=o;s>0;e[r+h]=255&u,h+=v,u/=256,s-=8);return e[r+h-v]|=128*d,null}(t,e,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,!(arguments.length>3&&void 0!==arguments[3])||arguments[3],arguments.length>4&&void 0!==arguments[4]?arguments[4]:52,arguments.length>5&&void 0!==arguments[5]?arguments[5]:8)}function vi(t){let e=[],r=[];if(!Tt(t)&&!Ro(t))return null;let n=[],o=[];function i(t){n.push(Jo(t)),o.push(t)}try{let u=ni(t);i(pi(u.results)),en(u.binarys,(t=>{i(t)}));let a=n,c=pi(JSON.stringify(a)),s=new Uint8Array(8);hi(Jo(c),s),e.push(s),e.push(c),en(o,(t=>{e.push(t)})),en(e,(t=>{r=function(t,e){let r=Jo(t),n=Jo(e),o=new Uint8Array(r+n);return o.set(new Uint8Array(t),0),o.set(new Uint8Array(e),r),o}(r,t)}))}catch(t){return null}return r}function di(t){return function(t,e,r,n,o){if(!Yo(t))return null;if(!Vt(e))return null;if(!kt(r))return null;if(!Vt(n))return null;if(!Vt(o))return null;let i,u,a=8*o-n-1,c=(1<<a)-1,s=c>>1,f=-7,l=r?0:o-1,p=r?1:-1,h=t[e+l];for(l+=p,i=h&(1<<-f)-1,h>>=-f,f+=a;f>0;i=256*i+t[e+l],l+=p,f-=8);for(u=i&(1<<-f)-1,i>>=-f,f+=n;f>0;u=256*u+t[e+l],l+=p,f-=8);if(0===i)i=1-s;else{if(i===c)return u?NaN:1/0*(h?-1:1);u+=Math.pow(2,n),i-=s}return(h?-1:1)*u*Math.pow(2,i-n)}(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,!(arguments.length>2&&void 0!==arguments[2])||arguments[2],arguments.length>3&&void 0!==arguments[3]?arguments[3]:52,arguments.length>4&&void 0!==arguments[4]?arguments[4]:8)}var yi={};!function(t,e){var r;t.exports=(r=ci(),function(){if("function"==typeof ArrayBuffer){var t=r.lib.WordArray,e=t.init,n=t.init=function(t){if(t instanceof ArrayBuffer&&(t=new Uint8Array(t)),(t instanceof Int8Array||"undefined"!=typeof Uint8ClampedArray&&t instanceof Uint8ClampedArray||t instanceof Int16Array||t instanceof Uint16Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array||t instanceof Float64Array)&&(t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength)),t instanceof Uint8Array){for(var r=t.byteLength,n=[],o=0;o<r;o++)n[o>>>2]|=t[o]<<24-o%4*8;e.call(this,n,r)}else e.apply(this,arguments)};n.prototype=t}}(),r.lib.WordArray)}({get exports(){return yi},set exports(t){yi=t}});var bi=yi;function gi(t){if(!Yo(t))return"";let e;try{r=function(t){return Yo(t)?bi.create(t).toString(li):""}(t),e=Yt(r)?li.parse(r).toString(si):""}catch(t){return""}var r;return e}function mi(t){let e=null;if(!Yo(t))return null;try{let r=8,n=t.slice(0,r),o=t.slice(r,Jo(t)),i=di(n),u=o.slice(0,i),a=o.slice(i,Jo(o)),c=gi(u),s=function(t,e){let r=0,n=0,o=[];return en(e,(e=>{n=r+e;let i=t.slice(r,n);r=n,o.push(i)})),o}(a,JSON.parse(c));e=function(t){if(!Ro(t))return{};let{results:e,binarys:r}=t;if(!Yt(e))return{};if(!_t(r))return{};let n={};try{n=JSON.parse(e,(function(t,e){if(Yt(e)){if(e.indexOf("[Uint8Array]::")>=0){let t=Po(e.replace("[Uint8Array]::",""));return r[t]}if(e.indexOf("[Uint16Array]::")>=0){let t=Po(e.replace("[Uint16Array]::",""));return r[t]}if(e.indexOf("[ArrayBuffer]::")>=0){let t=Po(e.replace("[ArrayBuffer]::",""));return r[t]}}return e}))}catch(t){}return n}({results:gi(s.shift()),binarys:s})}catch(t){}return e}function ji(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i={};o.port||(o.port=8080),o.apiName||(o.apiName="api");let a,c=new r.EventEmitter,s=Lo();function f(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];setTimeout((()=>{c.emit(t,...r)}),1)}async function l(t){let e=vo(),r=vo(),n=wt(t,"_mode","");if(r.then((r=>{t.output=r,delete t.input,e.resolve(t)})).catch((t=>{e.reject(t)})),"execute"===n){f("execute",wt(t,"func",""),wt(t,"input",null),r)}else if("broadcast"===n){f("broadcast",wt(t,"input",null)),r.resolve("ok")}else if("deliver"===n){f("deliver",wt(t,"input",null)),r.resolve("ok")}else if("polling"===n){let e=wt(t,"clientId",""),n=wt(i,e,[]);n=ho(n),i[e]=[],r.resolve(n)}else{let n="can not find _mode in data";!function(t,e){f("error",{msg:t,err:e})}(n,t),e.reject(n),r.reject()}return e}setInterval((()=>{let t=s.get(),e=(n="key",(u(r=t)?lt:Xr)(r,Vr(n)));var r,n;let o={};en(e,(t=>{o[t]=wt(i,t,[])})),i=o}),1e3),a=o.serverHapi?o.serverHapi:t.server({port:o.port,routes:{cors:{origin:["*"]}}}),f("open"),s.on("message",(function(t){let{eventName:e,key:r,data:n,now:o}=t;"enter"===e?f("clientEnter",r,n):"leave"===e&&f("clientLeave",r,n),f("clientChange",o)}));let p={path:"/"+o.apiName,method:"POST",options:{payload:{maxBytes:1073741824,timeout:18e4,multipart:!0},timeout:{socket:3e5}},handler:async function(t,e){let r=wt(t,"headers");r=Ro(r)?r:"";let o=wt(t,"query");o=Ro(o)?o:"",f("handler",{headers:r,query:o});let i=wt(t,"payload.bb",null);xt(i)&&(i=Buffer.from(i,"utf8"));let u=mi(new Uint8Array(i)),a=wt(u,"clientId"),c={headers:t.headers,info:t.info};s.trigger(a,c);let p={};await l(u).then((function(t){p.success=t})).catch((function(t){p.error=t}));let h=vi(p),v=new n.Readable;return v._read=()=>{},v.push(h),v.push(null),e.response(v).header("Cache-Control","no-cache, no-store, must-revalidate").header("Content-Type","application/octet-stream").header("Content-Length",v.readableLength)}};return c.broadcast=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};if(Mt(i))return;let r={};en(i,((e,n)=>{e.push({mode:"broadcast",data:t}),r[n]=e})),i=r,e(100)},c.deliver=function(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},n=wt(i,t,[]);n.push({mode:"deliver",data:e}),i[t]=n,r(100)},o.serverHapi?o.serverHapi.route(p):async function(){await a.register(e),a.route([{method:"GET",path:"/{file*}",handler:{directory:{path:"./"}}},p]),await a.start(),console.log(`Server running at: ${a.info.uri}`)}(),c}let wi="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),_i=wi.length;function Oi(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:32,e=[];t=zo(t)?Po(t):32;for(let r=0;r<t;r++)e[r]=wi[0|Math.random()*_i];return e.join("")}var Si=function(){return s.Date.now()},Ai="Expected a function",xi=Math.max,$i=Math.min;function Mi(t,e,r){var n,o,i,u,a,c,s=0,f=!1,l=!1,p=!0;if("function"!=typeof t)throw new TypeError(Ai);function h(e){var r=n,i=o;return n=o=void 0,s=e,u=t.apply(i,r)}function v(t){var r=t-c;return void 0===c||r>=e||r<0||l&&t-s>=i}function d(){var t=Si();if(v(t))return y(t);a=setTimeout(d,function(t){var r=e-(t-c);return l?$i(r,i-(t-s)):r}(t))}function y(t){return a=void 0,p&&n?h(t):(n=o=void 0,u)}function b(){var t=Si(),r=v(t);if(n=arguments,o=this,c=t,r){if(void 0===a)return function(t){return s=t,a=setTimeout(d,e),f?h(t):u}(c);if(l)return clearTimeout(a),a=setTimeout(d,e),h(c)}return void 0===a&&(a=setTimeout(d,e)),u}return e=zt(e)||0,x(r)&&(f=!!r.leading,i=(l="maxWait"in r)?xi(zt(r.maxWait)||0,e):i,p="trailing"in r?!!r.trailing:p),b.cancel=function(){void 0!==a&&clearTimeout(a),s=0,n=c=o=a=void 0},b.flush=function(){return void 0===a?u:y(Si())},b}function Ti(t,e,r){(void 0!==r&&!G(t[e],r)||void 0===r&&!(e in t))&&on(t,e,r)}function Di(t,e){if(("constructor"!==e||"function"!=typeof t[e])&&"__proto__"!=e)return t[e]}function ki(t,e,r,n,o,i,a){var c=Di(t,r),s=Di(e,r),f=a.get(s);if(f)Ti(t,r,f);else{var l,p=i?i(c,s,r+"",t,e,a):void 0,h=void 0===p;if(h){var v=u(s),d=!v&&ze(s),y=!v&&!d&&Xe(s);p=s,v||d||y?u(c)?p=c:j(l=c)&&cr(l)?p=bn(c):d?(h=!1,p=yn(s,!0)):y?(h=!1,p=$n(s,!0)):p=[]:ti(s)||Ee(s)?(p=c,Ee(c)?p=function(t){return cn(t,ln(t))}(c):x(c)&&!k(c)||(p=Qn(s))):h=!1}h&&(a.set(s,p),o(p,s,n,i,a),a.delete(s)),Ti(t,r,p)}}function Ui(t,e,r,n,o){t!==e&&Zr(e,(function(i,u){if(o||(o=new Xt),x(i))ki(t,e,u,r,Ui,n,o);else{var a=n?n(Di(t,u),i,u+"",t,e,o):void 0;void 0===a&&(a=i),Ti(t,u,a)}}),ln)}var Ni=Math.max;var Bi=nn?function(t,e){return nn(t,"toString",{configurable:!0,enumerable:!1,value:(r=e,function(){return r}),writable:!0});var r}:Yr,Ci=Bi,Ei=Date.now;var Ii=function(t){var e=0,r=0;return function(){var n=Ei(),o=16-(n-r);if(r=n,o>0){if(++e>=800)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}(Ci),Fi=Ii;function Pi(t,e){return Fi(function(t,e,r){return e=Ni(void 0===e?t.length-1:e,0),function(){for(var n=arguments,o=-1,i=Ni(n.length-e,0),u=Array(i);++o<i;)u[o]=n[e+o];o=-1;for(var a=Array(e+1);++o<e;)a[o]=n[o];return a[e]=r(u),function(t,e,r){switch(r.length){case 0:return t.call(e);case 1:return t.call(e,r[0]);case 2:return t.call(e,r[0],r[1]);case 3:return t.call(e,r[0],r[1],r[2])}return t.apply(e,r)}(t,this,a)}}(t,e,Yr),t+"")}var zi,Ri=(zi=function(t,e,r){Ui(t,e,r)},Pi((function(t,e){var r=-1,n=e.length,o=n>1?e[n-1]:void 0,i=n>2?e[2]:void 0;for(o=zi.length>3&&"function"==typeof o?(n--,o):void 0,i&&function(t,e,r){if(!x(r))return!1;var n=typeof e;return!!("number"==n?cr(r)&&Le(e,r.length):"string"==n&&e in r)&&G(r[e],t)}(e[0],e[1],i)&&(o=n<3?void 0:o,n=1),t=Object(t);++r<n;){var u=e[r];u&&zi(t,u,r,o)}return t}))),Wi={};!function(t,e){t.exports=function(){var t=1e3,e=6e4,r=36e5,n="millisecond",o="second",i="minute",u="hour",a="day",c="week",s="month",f="quarter",l="year",p="date",h="Invalid Date",v=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,d=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,y={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(t){var e=["th","st","nd","rd"],r=t%100;return"["+t+(e[(r-20)%10]||e[r]||e[0])+"]"}},b=function(t,e,r){var n=String(t);return!n||n.length>=e?t:""+Array(e+1-n.length).join(r)+t},g={s:b,z:function(t){var e=-t.utcOffset(),r=Math.abs(e),n=Math.floor(r/60),o=r%60;return(e<=0?"+":"-")+b(n,2,"0")+":"+b(o,2,"0")},m:function t(e,r){if(e.date()<r.date())return-t(r,e);var n=12*(r.year()-e.year())+(r.month()-e.month()),o=e.clone().add(n,s),i=r-o<0,u=e.clone().add(n+(i?-1:1),s);return+(-(n+(r-o)/(i?o-u:u-o))||0)},a:function(t){return t<0?Math.ceil(t)||0:Math.floor(t)},p:function(t){return{M:s,y:l,w:c,d:a,D:p,h:u,m:i,s:o,ms:n,Q:f}[t]||String(t||"").toLowerCase().replace(/s$/,"")},u:function(t){return void 0===t}},m="en",j={};j[m]=y;var w="$isDayjsObject",_=function(t){return t instanceof x||!(!t||!t[w])},O=function t(e,r,n){var o;if(!e)return m;if("string"==typeof e){var i=e.toLowerCase();j[i]&&(o=i),r&&(j[i]=r,o=i);var u=e.split("-");if(!o&&u.length>1)return t(u[0])}else{var a=e.name;j[a]=e,o=a}return!n&&o&&(m=o),o||!n&&m},S=function(t,e){if(_(t))return t.clone();var r="object"==typeof e?e:{};return r.date=t,r.args=arguments,new x(r)},A=g;A.l=O,A.i=_,A.w=function(t,e){return S(t,{locale:e.$L,utc:e.$u,x:e.$x,$offset:e.$offset})};var x=function(){function y(t){this.$L=O(t.locale,null,!0),this.parse(t),this.$x=this.$x||t.x||{},this[w]=!0}var b=y.prototype;return b.parse=function(t){this.$d=function(t){var e=t.date,r=t.utc;if(null===e)return new Date(NaN);if(A.u(e))return new Date;if(e instanceof Date)return new Date(e);if("string"==typeof e&&!/Z$/i.test(e)){var n=e.match(v);if(n){var o=n[2]-1||0,i=(n[7]||"0").substring(0,3);return r?new Date(Date.UTC(n[1],o,n[3]||1,n[4]||0,n[5]||0,n[6]||0,i)):new Date(n[1],o,n[3]||1,n[4]||0,n[5]||0,n[6]||0,i)}}return new Date(e)}(t),this.init()},b.init=function(){var t=this.$d;this.$y=t.getFullYear(),this.$M=t.getMonth(),this.$D=t.getDate(),this.$W=t.getDay(),this.$H=t.getHours(),this.$m=t.getMinutes(),this.$s=t.getSeconds(),this.$ms=t.getMilliseconds()},b.$utils=function(){return A},b.isValid=function(){return!(this.$d.toString()===h)},b.isSame=function(t,e){var r=S(t);return this.startOf(e)<=r&&r<=this.endOf(e)},b.isAfter=function(t,e){return S(t)<this.startOf(e)},b.isBefore=function(t,e){return this.endOf(e)<S(t)},b.$g=function(t,e,r){return A.u(t)?this[e]:this.set(r,t)},b.unix=function(){return Math.floor(this.valueOf()/1e3)},b.valueOf=function(){return this.$d.getTime()},b.startOf=function(t,e){var r=this,n=!!A.u(e)||e,f=A.p(t),h=function(t,e){var o=A.w(r.$u?Date.UTC(r.$y,e,t):new Date(r.$y,e,t),r);return n?o:o.endOf(a)},v=function(t,e){return A.w(r.toDate()[t].apply(r.toDate("s"),(n?[0,0,0,0]:[23,59,59,999]).slice(e)),r)},d=this.$W,y=this.$M,b=this.$D,g="set"+(this.$u?"UTC":"");switch(f){case l:return n?h(1,0):h(31,11);case s:return n?h(1,y):h(0,y+1);case c:var m=this.$locale().weekStart||0,j=(d<m?d+7:d)-m;return h(n?b-j:b+(6-j),y);case a:case p:return v(g+"Hours",0);case u:return v(g+"Minutes",1);case i:return v(g+"Seconds",2);case o:return v(g+"Milliseconds",3);default:return this.clone()}},b.endOf=function(t){return this.startOf(t,!1)},b.$set=function(t,e){var r,c=A.p(t),f="set"+(this.$u?"UTC":""),h=(r={},r[a]=f+"Date",r[p]=f+"Date",r[s]=f+"Month",r[l]=f+"FullYear",r[u]=f+"Hours",r[i]=f+"Minutes",r[o]=f+"Seconds",r[n]=f+"Milliseconds",r)[c],v=c===a?this.$D+(e-this.$W):e;if(c===s||c===l){var d=this.clone().set(p,1);d.$d[h](v),d.init(),this.$d=d.set(p,Math.min(this.$D,d.daysInMonth())).$d}else h&&this.$d[h](v);return this.init(),this},b.set=function(t,e){return this.clone().$set(t,e)},b.get=function(t){return this[A.p(t)]()},b.add=function(n,f){var p,h=this;n=Number(n);var v=A.p(f),d=function(t){var e=S(h);return A.w(e.date(e.date()+Math.round(t*n)),h)};if(v===s)return this.set(s,this.$M+n);if(v===l)return this.set(l,this.$y+n);if(v===a)return d(1);if(v===c)return d(7);var y=(p={},p[i]=e,p[u]=r,p[o]=t,p)[v]||1,b=this.$d.getTime()+n*y;return A.w(b,this)},b.subtract=function(t,e){return this.add(-1*t,e)},b.format=function(t){var e=this,r=this.$locale();if(!this.isValid())return r.invalidDate||h;var n=t||"YYYY-MM-DDTHH:mm:ssZ",o=A.z(this),i=this.$H,u=this.$m,a=this.$M,c=r.weekdays,s=r.months,f=r.meridiem,l=function(t,r,o,i){return t&&(t[r]||t(e,n))||o[r].slice(0,i)},p=function(t){return A.s(i%12||12,t,"0")},v=f||function(t,e,r){var n=t<12?"AM":"PM";return r?n.toLowerCase():n};return n.replace(d,(function(t,n){return n||function(t){switch(t){case"YY":return String(e.$y).slice(-2);case"YYYY":return A.s(e.$y,4,"0");case"M":return a+1;case"MM":return A.s(a+1,2,"0");case"MMM":return l(r.monthsShort,a,s,3);case"MMMM":return l(s,a);case"D":return e.$D;case"DD":return A.s(e.$D,2,"0");case"d":return String(e.$W);case"dd":return l(r.weekdaysMin,e.$W,c,2);case"ddd":return l(r.weekdaysShort,e.$W,c,3);case"dddd":return c[e.$W];case"H":return String(i);case"HH":return A.s(i,2,"0");case"h":return p(1);case"hh":return p(2);case"a":return v(i,u,!0);case"A":return v(i,u,!1);case"m":return String(u);case"mm":return A.s(u,2,"0");case"s":return String(e.$s);case"ss":return A.s(e.$s,2,"0");case"SSS":return A.s(e.$ms,3,"0");case"Z":return o}return null}(t)||o.replace(":","")}))},b.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},b.diff=function(n,p,h){var v,d=this,y=A.p(p),b=S(n),g=(b.utcOffset()-this.utcOffset())*e,m=this-b,j=function(){return A.m(d,b)};switch(y){case l:v=j()/12;break;case s:v=j();break;case f:v=j()/3;break;case c:v=(m-g)/6048e5;break;case a:v=(m-g)/864e5;break;case u:v=m/r;break;case i:v=m/e;break;case o:v=m/t;break;default:v=m}return h?v:A.a(v)},b.daysInMonth=function(){return this.endOf(s).$D},b.$locale=function(){return j[this.$L]},b.locale=function(t,e){if(!t)return this.$L;var r=this.clone(),n=O(t,e,!0);return n&&(r.$L=n),r},b.clone=function(){return A.w(this.$d,this)},b.toDate=function(){return new Date(this.valueOf())},b.toJSON=function(){return this.isValid()?this.toISOString():null},b.toISOString=function(){return this.$d.toISOString()},b.toString=function(){return this.$d.toUTCString()},y}(),$=x.prototype;return S.prototype=$,[["$ms",n],["$s",o],["$m",i],["$H",u],["$W",a],["$M",s],["$y",l],["$D",p]].forEach((function(t){$[t[1]]=function(e){return this.$g(e,t[0],t[1])}})),S.extend=function(t,e){return t.$i||(t(e,x,S),t.$i=!0),S},S.locale=O,S.isDayjs=_,S.unix=function(t){return S(1e3*t)},S.en=j[m],S.Ls=j,S.p={},S}()}({get exports(){return Wi},set exports(t){Wi=t}});var Li=Wi;function Hi(t){let e=Object.prototype.toString.call(t);return"[object Function]"===e||"[object AsyncFunction]"===e}let Yi=o.resolve();function qi(){let t={},e=wt(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"fnTableTags");Yt(e)||(e="tableTags.json"),e=`${Yi}/${e}`;let r=Kt();function n(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),o=1;o<e;o++)n[o-1]=arguments[o];setTimeout((()=>{r.emit(t,...n)}),1)}function o(){let t={};try{if(i.existsSync(e)){let r=function(t){if(!Yt(t))return{};let e={};try{e=JSON.parse(t)}catch(t){e={}}return e}(i.readFileSync(e,"utf8"));Ro(r)&&(t=r)}}catch(t){n("error",{msg:"readTableTags catch",err:t})}return t}function u(){try{let r=function(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(Ot(t))return"";let r="";try{r=e?JSON.stringify(t,null,2):JSON.stringify(t)}catch(t){r=""}return r}(t);i.writeFileSync(e,r,"utf8")}catch(t){n("error",{msg:"writeTableTags catch",err:t})}}let a=Mi((()=>{u(),n("changeTableTags",t)}),200);return r.readTableTags=o,r.writeTableTags=u,r.initTableTags=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"useInputFirst";t="useStorageFirst"===r?Ri(e,o()):"useInputOnly"===r?e:"useStorageOnly"===r?o():Ri(o(),e),u()},r.setTableTags=function(){t=Ri(t,arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),u()},r.getTableTags=function(){return t},r.updateTableTag=function(e){t[e]=function(){if(!Hi(Li))throw new Error("invalid dayjs");return Li().format("YYYY-MM-DDTHH:mm:ssZ")}()+"|"+Oi(6),a()},r}function Ji(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=Kt(),r=wt(t,"instWConverServer",null);if(null===r)return e.emit("error","invalid opt.instWConverServer"),e;let n=wt(t,"dbORMs",null);if(!St(n))return e.emit("error","invalid opt.dbORMs"),e;let o=wt(t,"tableNames",null);if(!_t(o))return e.emit("error","invalid opt.tableNames"),e;0===Bo(o)&&console.log("opt.tableNames.lenght = 0");let i=wt(t,"fnTableTags",null);Yt(i)||(i="tableTags.json");let u=new qi({fnTableTags:i});o=ho(o);let a={};function c(t){let e={};return en(o,(r=>{let n=r,o=t[r];e[n]=o})),e}return en(o,(t=>{a[t]=Oi(6)})),u.initTableTags(a,"useInputOnly"),en(o,(t=>{let e=n[t];if(!e)throw new Error(`invalid dbORMs.${t}`);e.on("change",(()=>{u.updateTableTag(t)}))})),r.on("clientEnter",(function(t,e){r.deliver(t,{mode:"syncTable",data:u.readTableTags()})})),u.on("changeTableTags",(t=>{r.broadcast({mode:"syncTable",data:c(t)})})),u}function Vi(t){return Vi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Vi(t)}function Gi(t){var e=function(t,e){if("object"!==Vi(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==Vi(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===Vi(e)?e:String(e)}function Zi(t,e,r){return(e=Gi(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Qi(t){let e,r=Object.prototype.toString.call(t);if(e="[object Promise]"===r,e)return!0;if("[object Function]"!==r)return!1;try{e="function"!=typeof t.subscribe&&"function"==typeof t.then}catch(t){}return e}let Ki=function(t){if(!Hi(t))throw new Error("fn is not a function");return function(){let e=vo(),r=null,n=null;try{r=t.apply(this,arguments)}catch(t){n=t}return null!==n?e.resolve({state:"error",msg:n}):Qi(r)?r.then((t=>{e.resolve({state:"success",msg:t})})).catch((t=>{"cancelled"===wt(t,"reason")?e.resolve({state:"cancelled",msg:""}):e.resolve({state:"error",msg:t})})):e.resolve({state:"success",msg:r}),e}};function Xi(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function tu(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Xi(Object(r),!0).forEach((function(e){Zi(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Xi(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}let eu={},ru=null;async function nu(t){let{func:e,input:r,pm:n}=t,o="";if(!Wo(r,"__sysToken__"))return n.resolve({state:"error",msg:"invalid token"}),n;if(o=function(t){if(!Yt(t)&&!qt(t)&&!_(t))return"";let e="";try{e=String(t)}catch(t){}try{e=t.toString()}catch(t){}return e}(r.__sysToken__),!Wo(r,"__sysInputArgs__"))return n.resolve({state:"error",msg:"invalid input"}),n;r=r.__sysInputArgs__;let i="",u=ru(o);if(i=Qi(u)?await u:u,Yt(i)||(i=""),"getFuncList"===e){let t={state:"success",msg:sr(eu)};return n.resolve(t),n}if(!Wo(eu,e))return n.resolve({state:"error",msg:`invalid func[${e}]`}),n;let a=eu[e];try{let t=await Ki(a)(i,...r);n.resolve(t)}catch(t){n.resolve({state:"error",msg:`func: ${e}`})}return n}function ou(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=Kt(),r=wt(t,"instWConverServer",null);if(null===r)return e.emit("error","invalid opt.instWConverServer"),e;ru=wt(t,"cbGetUserIDFromToken",null),Hi(ru)||(ru=async()=>"");let n=wt(t,"useDbORM",null);kt(n)||(n=!0);let o=null;if(n&&(o=wt(t,"operORM",null),!Hi(o)))return e.emit("error","invalid opt.operORM when useDbORM=true"),e;let i=[];if(n&&(i=wt(t,"tableNames",null),!_t(i)))return e.emit("error","invalid opt.tableNames when useDbORM=true"),e;let u=[];n&&(u=wt(t,"methods",null),_t(u)||(u=["select","insert","save","del"]));let a=wt(t,"extFuncs",null),c=wt(t,"hookBefores",null),s=wt(t,"hookAfters",null),f={};return n&&(i=ho(i),f=function(t,e,r){let n={};return en(t,(t=>{en(e,(e=>{n[`${t}.${e}`]=async function(n,o){return await r(n,t,e,o)}}))})),n}(i,u,o)),St(a)&&en(a,((t,e)=>{f[e]=t})),eu=f,r.on("execute",(async function(t,r,n){let o={func:t,input:r,pm:n};if(Hi(c))try{c(o)}catch(t){e.emit("error",t)}else Tt(c)&&en(c,(t=>{if(Hi(t))try{t(o)}catch(t){e.emit("error",t)}}));let i=await nu(o).catch((t=>{e.emit("error",t)})),u=tu(tu({},o),{},{output:i});if(Hi(s))try{s(u)}catch(t){e.emit("error",t)}else Tt(s)&&en(s,(t=>{if(Hi(t))try{t(u)}catch(t){e.emit("error",t)}}))})),e}function iu(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=null,r=null,n=Kt(),o=wt(t,"instWConverServer",null);if(null===o)return n.emit("error","invalid opt.instWConverServer"),n;let i=wt(t,"useDbORM",null);kt(i)||(i=!0);let u=wt(t,"dbORMs",null),a=wt(t,"operORM",null),c=wt(t,"tableNamesExec",null),s=wt(t,"methodsExec",null),f=wt(t,"tableNamesSync",null),l=wt(t,"cbGetUserIDFromToken",null),p=wt(t,"extFuncs",null),h=wt(t,"hookBefores",null),v=wt(t,"hookAfters",null),d=wt(t,"fnTableTags",null);if(e=new ou({instWConverServer:o,cbGetUserIDFromToken:l,useDbORM:i,operORM:a,tableNames:c,methods:s,extFuncs:p,hookBefores:h,hookAfters:v}),e.on("error",(t=>{n.emit("error",t)})),i){if(!St(u))return n.emit("error","invalid opt.dbORMs when useDbORM=true"),n;r=new Ji({instWConverServer:o,dbORMs:u,tableNames:f,fnTableTags:d}),r.on("error",(t=>{n.emit("error",t)}))}return n.getInstWServWebdataServerExec=()=>e,n.getInstWServWebdataServerSync=()=>r,n}return function(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=null,o=null,i=null,u=Kt(),a=wt(r,"port");Vt(a)||(a=8080);let c=wt(r,"useCors");kt(c)||(c=!0);let s=wt(r,"useInert");kt(s)||(s=!0);let f=wt(r,"pathStaticFiles");Yt(f)||(f="dist");let l=wt(r,"apis");Tt(l)||(l=[]);let p=wt(r,"getUserIDFromToken",null),h=wt(r,"useDbORM",null);kt(h)||(h=!0);let v=wt(r,"dbORMs",null),d=wt(r,"operORM",null),y=wt(r,"tableNamesExec",null),b=wt(r,"methodsExec",null),g=wt(r,"tableNamesSync",null),m=wt(r,"extFuncs",null),j=wt(r,"hookBefores",null),w=wt(r,"hookAfters",null),_=wt(r,"fnTableTags",null),O=wt(r,"showLog");return kt(O)||(O=!0),(async()=>{await(async()=>{n=new t.Server({port:a,routes:{cors:c}}),s&&await n.register(e);let r=[];s&&(r=[{method:"GET",path:"/{file*}",handler:{directory:{path:`${f}/`}}}]),r=[...r,...l],n.route(r)})(),await(async()=>{o=new ji({serverHapi:n}),o.on("open",(function(){O&&console.log(`Server[port:${a}]: open`)})),o.on("error",(function(t){O&&console.log(`Server[port:${a}]: error`,t),u.emit("error",{mode:"instWConverhpServer error",err:t})})),o.on("clientChange",(function(t){O&&console.log(`Server[port:${a}]: now clients: ${t}`)}))})(),await(async()=>{i=new iu({instWConverServer:o,cbGetUserIDFromToken:p,useDbORM:h,dbORMs:v,operORM:d,tableNamesExec:y,tableNamesSync:g,methodsExec:b,extFuncs:m,hookBefores:j,hookAfters:w,fnTableTags:_}),i.on("error",(t=>{O&&console.log("error",t),u.emit("error",{mode:"instWServWebdataServer error",err:t})}))})(),await n.start(),O&&console.log(`Server running at: ${n.info.uri}`)})(),process.on("unhandledRejection",(t=>{console.log("unhandledRejection",t),u.emit("error",{mode:"unhandledRejection",err:t})})),process.on("uncaughtException",(t=>{console.log("uncaughtException",t),u.emit("error",{mode:"uncaughtException",err:t})})),u.getServer=()=>n,u.getInstWConverhpServer=()=>o,u.getInstWServWebdataServer=()=>i,u}}));
//# sourceMappingURL=w-serv-hapi-server.umd.js.map
