/*!
 * w-serv-hapi-server v1.0.11
 * (c) 2018-2021 yuda-lyu(semisphere)
 * Released under the MIT License.
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("@hapi/hapi"),require("@hapi/inert"),require("events"),require("stream"),require("path"),require("fs")):"function"==typeof define&&define.amd?define(["@hapi/hapi","@hapi/inert","events","stream","path","fs"],e):(t="undefined"!=typeof globalThis?globalThis:t||self)["w-serv-hapi-server"]=e(t["@hapi/hapi"],t["@hapi/inert"],t.events,t.stream,t.path,t.fs)}(this,(function(t,e,r,n,o,i){"use strict";var u="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function a(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var c=Array.isArray,s="object"==typeof u&&u&&u.Object===Object&&u,f=s,l="object"==typeof self&&self&&self.Object===Object&&self,v=f||l||Function("return this")(),h=v.Symbol,p=h,y=Object.prototype,d=y.hasOwnProperty,b=y.toString,g=p?p.toStringTag:void 0;var m=function(t){var e=d.call(t,g),r=t[g];try{t[g]=void 0;var n=!0}catch(t){}var o=b.call(t);return n&&(e?t[g]=r:delete t[g]),o},j=Object.prototype.toString;var _=m,w=function(t){return j.call(t)},O=h?h.toStringTag:void 0;var S=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":O&&O in Object(t)?_(t):w(t)};var A=function(t){return null!=t&&"object"==typeof t},x=S,$=A;var M=function(t){return"symbol"==typeof t||$(t)&&"[object Symbol]"==x(t)},T=c,D=M,U=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,k=/^\w*$/;var N=function(t,e){if(T(t))return!1;var r=typeof t;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=t&&!D(t))||(k.test(t)||!U.test(t)||null!=e&&t in Object(e))};var I=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)},B=S,C=I;var E,P=function(t){if(!C(t))return!1;var e=B(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e},F=v["__core-js_shared__"],z=(E=/[^.]+$/.exec(F&&F.keys&&F.keys.IE_PROTO||""))?"Symbol(src)_1."+E:"";var R=function(t){return!!z&&z in t},W=Function.prototype.toString;var L=function(t){if(null!=t){try{return W.call(t)}catch(t){}try{return t+""}catch(t){}}return""},H=P,Y=R,q=I,J=L,V=/^\[object .+?Constructor\]$/,G=Function.prototype,Z=Object.prototype,Q=G.toString,K=Z.hasOwnProperty,X=RegExp("^"+Q.call(K).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var tt=function(t){return!(!q(t)||Y(t))&&(H(t)?X:V).test(J(t))},et=function(t,e){return null==t?void 0:t[e]};var rt=function(t,e){var r=et(t,e);return tt(r)?r:void 0},nt=rt(Object,"create"),ot=nt;var it=function(){this.__data__=ot?ot(null):{},this.size=0};var ut=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},at=nt,ct=Object.prototype.hasOwnProperty;var st=function(t){var e=this.__data__;if(at){var r=e[t];return"__lodash_hash_undefined__"===r?void 0:r}return ct.call(e,t)?e[t]:void 0},ft=nt,lt=Object.prototype.hasOwnProperty;var vt=nt;var ht=it,pt=ut,yt=st,dt=function(t){var e=this.__data__;return ft?void 0!==e[t]:lt.call(e,t)},bt=function(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=vt&&void 0===e?"__lodash_hash_undefined__":e,this};function gt(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}gt.prototype.clear=ht,gt.prototype.delete=pt,gt.prototype.get=yt,gt.prototype.has=dt,gt.prototype.set=bt;var mt=gt;var jt=function(){this.__data__=[],this.size=0};var _t=function(t,e){return t===e||t!=t&&e!=e},wt=_t;var Ot=function(t,e){for(var r=t.length;r--;)if(wt(t[r][0],e))return r;return-1},St=Ot,At=Array.prototype.splice;var xt=Ot;var $t=Ot;var Mt=Ot;var Tt=jt,Dt=function(t){var e=this.__data__,r=St(e,t);return!(r<0)&&(r==e.length-1?e.pop():At.call(e,r,1),--this.size,!0)},Ut=function(t){var e=this.__data__,r=xt(e,t);return r<0?void 0:e[r][1]},kt=function(t){return $t(this.__data__,t)>-1},Nt=function(t,e){var r=this.__data__,n=Mt(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this};function It(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}It.prototype.clear=Tt,It.prototype.delete=Dt,It.prototype.get=Ut,It.prototype.has=kt,It.prototype.set=Nt;var Bt=It,Ct=rt(v,"Map"),Et=mt,Pt=Bt,Ft=Ct;var zt=function(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t};var Rt=function(t,e){var r=t.__data__;return zt(e)?r["string"==typeof e?"string":"hash"]:r.map},Wt=Rt;var Lt=Rt;var Ht=Rt;var Yt=Rt;var qt=function(t,e){var r=Yt(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this},Jt=function(){this.size=0,this.__data__={hash:new Et,map:new(Ft||Pt),string:new Et}},Vt=function(t){var e=Wt(this,t).delete(t);return this.size-=e?1:0,e},Gt=function(t){return Lt(this,t).get(t)},Zt=function(t){return Ht(this,t).has(t)},Qt=qt;function Kt(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}Kt.prototype.clear=Jt,Kt.prototype.delete=Vt,Kt.prototype.get=Gt,Kt.prototype.has=Zt,Kt.prototype.set=Qt;var Xt=Kt,te=Xt;function ee(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new TypeError("Expected a function");var r=function(){var n=arguments,o=e?e.apply(this,n):n[0],i=r.cache;if(i.has(o))return i.get(o);var u=t.apply(this,n);return r.cache=i.set(o,u)||i,u};return r.cache=new(ee.Cache||te),r}ee.Cache=te;var re=ee;var ne=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,oe=/\\(\\)?/g,ie=function(t){var e=re(t,(function(t){return 500===r.size&&r.clear(),t})),r=e.cache;return e}((function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(ne,(function(t,r,n,o){e.push(n?o.replace(oe,"$1"):r||t)})),e}));var ue=function(t,e){for(var r=-1,n=null==t?0:t.length,o=Array(n);++r<n;)o[r]=e(t[r],r,t);return o},ae=ue,ce=c,se=M,fe=h?h.prototype:void 0,le=fe?fe.toString:void 0;var ve=function t(e){if("string"==typeof e)return e;if(ce(e))return ae(e,t)+"";if(se(e))return le?le.call(e):"";var r=e+"";return"0"==r&&1/e==-Infinity?"-0":r},he=ve;var pe=function(t){return null==t?"":he(t)},ye=c,de=N,be=ie,ge=pe;var me=function(t,e){return ye(t)?t:de(t,e)?[t]:be(ge(t))},je=M;var _e=function(t){if("string"==typeof t||je(t))return t;var e=t+"";return"0"==e&&1/t==-Infinity?"-0":e},we=me,Oe=_e;var Se=function(t,e){for(var r=0,n=(e=we(e,t)).length;null!=t&&r<n;)t=t[Oe(e[r++])];return r&&r==n?t:void 0},Ae=Se;var xe=function(t,e,r){var n=null==t?void 0:Ae(t,e);return void 0===n?r:n};function $e(t){return"[object Array]"===Object.prototype.toString.call(t)}function Me(t){return"[object Undefined]"===Object.prototype.toString.call(t)}function Te(t){return"[object Object]"===Object.prototype.toString.call(t)}function De(t){if(Te(t)){for(let e in t)return!1;return!0}return!1}function Ue(t){return"[object String]"===Object.prototype.toString.call(t)}function ke(t){return!!Me(t)||(!!function(t){return"[object Null]"===Object.prototype.toString.call(t)}(t)||(!!De(t)||(!!function(t){return!(!Ue(t)||""!==t)}(t)||!!function(t){return!!$e(t)&&0===t.length}(t))))}function Ne(t){return!!$e(t)&&(0!==t.length&&(1!==t.length||!ke(t[0])))}var Ie=S,Be=A;var Ce=function(t){return!0===t||!1===t||Be(t)&&"[object Boolean]"==Ie(t)};function Ee(t){return Ce(t)}var Pe=/\s/;var Fe=function(t){for(var e=t.length;e--&&Pe.test(t.charAt(e)););return e},ze=/^\s+/;var Re=function(t){return t?t.slice(0,Fe(t)+1).replace(ze,""):t},We=I,Le=M,He=/^[-+]0x[0-9a-f]+$/i,Ye=/^0b[01]+$/i,qe=/^0o[0-7]+$/i,Je=parseInt;var Ve=function(t){if("number"==typeof t)return t;if(Le(t))return NaN;if(We(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=We(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=Re(t);var r=Ye.test(t);return r||qe.test(t)?Je(t.slice(2),r?2:8):He.test(t)?NaN:+t},Ge=Ve,Ze=1/0;var Qe=function(t){return t?(t=Ge(t))===Ze||t===-1/0?17976931348623157e292*(t<0?-1:1):t==t?t:0:0===t?t:0},Ke=Qe;var Xe=function(t){var e=Ke(t),r=e%1;return e==e?r?e-r:e:0},tr=Xe;var er=function(t){return"number"==typeof t&&t==tr(t)};function rr(t){return!(!Ue(t)||""===t)}function nr(t){let e=!1;return rr(t)?e=!isNaN(Number(t)):function(t){return"[object Number]"===Object.prototype.toString.call(t)}(t)&&(e=!0),e}function or(t){if(!nr(t))return 0;return Qe(t)}function ir(t){return!!nr(t)&&(t=or(t),er(t))}var ur={};!function(t){var e=Object.prototype.hasOwnProperty,r="~";function n(){}function o(t,e,r){this.fn=t,this.context=e,this.once=r||!1}function i(t,e,n,i,u){if("function"!=typeof n)throw new TypeError("The listener must be a function");var a=new o(n,i||t,u),c=r?r+e:e;return t._events[c]?t._events[c].fn?t._events[c]=[t._events[c],a]:t._events[c].push(a):(t._events[c]=a,t._eventsCount++),t}function u(t,e){0==--t._eventsCount?t._events=new n:delete t._events[e]}function a(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(r=!1)),a.prototype.eventNames=function(){var t,n,o=[];if(0===this._eventsCount)return o;for(n in t=this._events)e.call(t,n)&&o.push(r?n.slice(1):n);return Object.getOwnPropertySymbols?o.concat(Object.getOwnPropertySymbols(t)):o},a.prototype.listeners=function(t){var e=r?r+t:t,n=this._events[e];if(!n)return[];if(n.fn)return[n.fn];for(var o=0,i=n.length,u=new Array(i);o<i;o++)u[o]=n[o].fn;return u},a.prototype.listenerCount=function(t){var e=r?r+t:t,n=this._events[e];return n?n.fn?1:n.length:0},a.prototype.emit=function(t,e,n,o,i,u){var a=r?r+t:t;if(!this._events[a])return!1;var c,s,f=this._events[a],l=arguments.length;if(f.fn){switch(f.once&&this.removeListener(t,f.fn,void 0,!0),l){case 1:return f.fn.call(f.context),!0;case 2:return f.fn.call(f.context,e),!0;case 3:return f.fn.call(f.context,e,n),!0;case 4:return f.fn.call(f.context,e,n,o),!0;case 5:return f.fn.call(f.context,e,n,o,i),!0;case 6:return f.fn.call(f.context,e,n,o,i,u),!0}for(s=1,c=new Array(l-1);s<l;s++)c[s-1]=arguments[s];f.fn.apply(f.context,c)}else{var v,h=f.length;for(s=0;s<h;s++)switch(f[s].once&&this.removeListener(t,f[s].fn,void 0,!0),l){case 1:f[s].fn.call(f[s].context);break;case 2:f[s].fn.call(f[s].context,e);break;case 3:f[s].fn.call(f[s].context,e,n);break;case 4:f[s].fn.call(f[s].context,e,n,o);break;default:if(!c)for(v=1,c=new Array(l-1);v<l;v++)c[v-1]=arguments[v];f[s].fn.apply(f[s].context,c)}}return!0},a.prototype.on=function(t,e,r){return i(this,t,e,r,!1)},a.prototype.once=function(t,e,r){return i(this,t,e,r,!0)},a.prototype.removeListener=function(t,e,n,o){var i=r?r+t:t;if(!this._events[i])return this;if(!e)return u(this,i),this;var a=this._events[i];if(a.fn)a.fn!==e||o&&!a.once||n&&a.context!==n||u(this,i);else{for(var c=0,s=[],f=a.length;c<f;c++)(a[c].fn!==e||o&&!a[c].once||n&&a[c].context!==n)&&s.push(a[c]);s.length?this._events[i]=1===s.length?s[0]:s:u(this,i)}return this},a.prototype.removeAllListeners=function(t){var e;return t?(e=r?r+t:t,this._events[e]&&u(this,e)):(this._events=new n,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=r,a.EventEmitter=a,t.exports=a}({get exports(){return ur},set exports(t){ur=t}});var ar=ur;function cr(){return new ar}var sr=Bt;var fr=Bt,lr=Ct,vr=Xt;var hr=Bt,pr=function(){this.__data__=new sr,this.size=0},yr=function(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r},dr=function(t){return this.__data__.get(t)},br=function(t){return this.__data__.has(t)},gr=function(t,e){var r=this.__data__;if(r instanceof fr){var n=r.__data__;if(!lr||n.length<199)return n.push([t,e]),this.size=++r.size,this;r=this.__data__=new vr(n)}return r.set(t,e),this.size=r.size,this};function mr(t){var e=this.__data__=new hr(t);this.size=e.size}mr.prototype.clear=pr,mr.prototype.delete=yr,mr.prototype.get=dr,mr.prototype.has=br,mr.prototype.set=gr;var jr=mr;var _r=Xt,wr=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this},Or=function(t){return this.__data__.has(t)};function Sr(t){var e=-1,r=null==t?0:t.length;for(this.__data__=new _r;++e<r;)this.add(t[e])}Sr.prototype.add=Sr.prototype.push=wr,Sr.prototype.has=Or;var Ar=Sr,xr=function(t,e){for(var r=-1,n=null==t?0:t.length;++r<n;)if(e(t[r],r,t))return!0;return!1},$r=function(t,e){return t.has(e)};var Mr=function(t,e,r,n,o,i){var u=1&r,a=t.length,c=e.length;if(a!=c&&!(u&&c>a))return!1;var s=i.get(t),f=i.get(e);if(s&&f)return s==e&&f==t;var l=-1,v=!0,h=2&r?new Ar:void 0;for(i.set(t,e),i.set(e,t);++l<a;){var p=t[l],y=e[l];if(n)var d=u?n(y,p,l,e,t,i):n(p,y,l,t,e,i);if(void 0!==d){if(d)continue;v=!1;break}if(h){if(!xr(e,(function(t,e){if(!$r(h,e)&&(p===t||o(p,t,r,n,i)))return h.push(e)}))){v=!1;break}}else if(p!==y&&!o(p,y,r,n,i)){v=!1;break}}return i.delete(t),i.delete(e),v},Tr=v.Uint8Array;var Dr=function(t){var e=-1,r=Array(t.size);return t.forEach((function(t,n){r[++e]=[n,t]})),r};var Ur=Tr,kr=_t,Nr=Mr,Ir=Dr,Br=function(t){var e=-1,r=Array(t.size);return t.forEach((function(t){r[++e]=t})),r},Cr=h?h.prototype:void 0,Er=Cr?Cr.valueOf:void 0;var Pr=function(t,e,r,n,o,i,u){switch(r){case"[object DataView]":if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case"[object ArrayBuffer]":return!(t.byteLength!=e.byteLength||!i(new Ur(t),new Ur(e)));case"[object Boolean]":case"[object Date]":case"[object Number]":return kr(+t,+e);case"[object Error]":return t.name==e.name&&t.message==e.message;case"[object RegExp]":case"[object String]":return t==e+"";case"[object Map]":var a=Ir;case"[object Set]":var c=1&n;if(a||(a=Br),t.size!=e.size&&!c)return!1;var s=u.get(t);if(s)return s==e;n|=2,u.set(t,e);var f=Nr(a(t),a(e),n,o,i,u);return u.delete(t),f;case"[object Symbol]":if(Er)return Er.call(t)==Er.call(e)}return!1};var Fr=function(t,e){for(var r=-1,n=e.length,o=t.length;++r<n;)t[o+r]=e[r];return t},zr=Fr,Rr=c;var Wr=function(t,e,r){var n=e(t);return Rr(t)?n:zr(n,r(t))};var Lr=function(){return[]},Hr=function(t,e){for(var r=-1,n=null==t?0:t.length,o=0,i=[];++r<n;){var u=t[r];e(u,r,t)&&(i[o++]=u)}return i},Yr=Lr,qr=Object.prototype.propertyIsEnumerable,Jr=Object.getOwnPropertySymbols,Vr=Jr?function(t){return null==t?[]:(t=Object(t),Hr(Jr(t),(function(e){return qr.call(t,e)})))}:Yr;var Gr=function(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n},Zr=S,Qr=A;var Kr=function(t){return Qr(t)&&"[object Arguments]"==Zr(t)},Xr=A,tn=Object.prototype,en=tn.hasOwnProperty,rn=tn.propertyIsEnumerable,nn=Kr(function(){return arguments}())?Kr:function(t){return Xr(t)&&en.call(t,"callee")&&!rn.call(t,"callee")},on=nn,un={};var an=function(){return!1};!function(t,e){var r=v,n=an,o=e&&!e.nodeType&&e,i=o&&t&&!t.nodeType&&t,u=i&&i.exports===o?r.Buffer:void 0,a=(u?u.isBuffer:void 0)||n;t.exports=a}({get exports(){return un},set exports(t){un=t}},un);var cn=/^(?:0|[1-9]\d*)$/;var sn=function(t,e){var r=typeof t;return!!(e=null==e?9007199254740991:e)&&("number"==r||"symbol"!=r&&cn.test(t))&&t>-1&&t%1==0&&t<e};var fn=function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991},ln=S,vn=fn,hn=A,pn={};pn["[object Float32Array]"]=pn["[object Float64Array]"]=pn["[object Int8Array]"]=pn["[object Int16Array]"]=pn["[object Int32Array]"]=pn["[object Uint8Array]"]=pn["[object Uint8ClampedArray]"]=pn["[object Uint16Array]"]=pn["[object Uint32Array]"]=!0,pn["[object Arguments]"]=pn["[object Array]"]=pn["[object ArrayBuffer]"]=pn["[object Boolean]"]=pn["[object DataView]"]=pn["[object Date]"]=pn["[object Error]"]=pn["[object Function]"]=pn["[object Map]"]=pn["[object Number]"]=pn["[object Object]"]=pn["[object RegExp]"]=pn["[object Set]"]=pn["[object String]"]=pn["[object WeakMap]"]=!1;var yn=function(t){return hn(t)&&vn(t.length)&&!!pn[ln(t)]};var dn=function(t){return function(e){return t(e)}},bn={};!function(t,e){var r=s,n=e&&!e.nodeType&&e,o=n&&t&&!t.nodeType&&t,i=o&&o.exports===n&&r.process,u=function(){try{var t=o&&o.require&&o.require("util").types;return t||i&&i.binding&&i.binding("util")}catch(t){}}();t.exports=u}({get exports(){return bn},set exports(t){bn=t}},bn);var gn=yn,mn=dn,jn=bn&&bn.isTypedArray,_n=jn?mn(jn):gn,wn=Gr,On=on,Sn=c,An=un,xn=sn,$n=_n,Mn=Object.prototype.hasOwnProperty;var Tn=function(t,e){var r=Sn(t),n=!r&&On(t),o=!r&&!n&&An(t),i=!r&&!n&&!o&&$n(t),u=r||n||o||i,a=u?wn(t.length,String):[],c=a.length;for(var s in t)!e&&!Mn.call(t,s)||u&&("length"==s||o&&("offset"==s||"parent"==s)||i&&("buffer"==s||"byteLength"==s||"byteOffset"==s)||xn(s,c))||a.push(s);return a},Dn=Object.prototype;var Un=function(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||Dn)};var kn=function(t,e){return function(r){return t(e(r))}},Nn=kn(Object.keys,Object),In=Un,Bn=Nn,Cn=Object.prototype.hasOwnProperty;var En=function(t){if(!In(t))return Bn(t);var e=[];for(var r in Object(t))Cn.call(t,r)&&"constructor"!=r&&e.push(r);return e},Pn=P,Fn=fn;var zn=function(t){return null!=t&&Fn(t.length)&&!Pn(t)},Rn=Tn,Wn=En,Ln=zn;var Hn=function(t){return Ln(t)?Rn(t):Wn(t)},Yn=Wr,qn=Vr,Jn=Hn;var Vn=function(t){return Yn(t,Jn,qn)},Gn=Vn,Zn=Object.prototype.hasOwnProperty;var Qn=function(t,e,r,n,o,i){var u=1&r,a=Gn(t),c=a.length;if(c!=Gn(e).length&&!u)return!1;for(var s=c;s--;){var f=a[s];if(!(u?f in e:Zn.call(e,f)))return!1}var l=i.get(t),v=i.get(e);if(l&&v)return l==e&&v==t;var h=!0;i.set(t,e),i.set(e,t);for(var p=u;++s<c;){var y=t[f=a[s]],d=e[f];if(n)var b=u?n(d,y,f,e,t,i):n(y,d,f,t,e,i);if(!(void 0===b?y===d||o(y,d,r,n,i):b)){h=!1;break}p||(p="constructor"==f)}if(h&&!p){var g=t.constructor,m=e.constructor;g==m||!("constructor"in t)||!("constructor"in e)||"function"==typeof g&&g instanceof g&&"function"==typeof m&&m instanceof m||(h=!1)}return i.delete(t),i.delete(e),h},Kn=rt(v,"DataView"),Xn=Ct,to=rt(v,"Promise"),eo=rt(v,"Set"),ro=rt(v,"WeakMap"),no=S,oo=L,io="[object Map]",uo="[object Promise]",ao="[object Set]",co="[object WeakMap]",so="[object DataView]",fo=oo(Kn),lo=oo(Xn),vo=oo(to),ho=oo(eo),po=oo(ro),yo=no;(Kn&&yo(new Kn(new ArrayBuffer(1)))!=so||Xn&&yo(new Xn)!=io||to&&yo(to.resolve())!=uo||eo&&yo(new eo)!=ao||ro&&yo(new ro)!=co)&&(yo=function(t){var e=no(t),r="[object Object]"==e?t.constructor:void 0,n=r?oo(r):"";if(n)switch(n){case fo:return so;case lo:return io;case vo:return uo;case ho:return ao;case po:return co}return e});var bo=yo,go=jr,mo=Mr,jo=Pr,_o=Qn,wo=bo,Oo=c,So=un,Ao=_n,xo="[object Arguments]",$o="[object Array]",Mo="[object Object]",To=Object.prototype.hasOwnProperty;var Do=function(t,e,r,n,o,i){var u=Oo(t),a=Oo(e),c=u?$o:wo(t),s=a?$o:wo(e),f=(c=c==xo?Mo:c)==Mo,l=(s=s==xo?Mo:s)==Mo,v=c==s;if(v&&So(t)){if(!So(e))return!1;u=!0,f=!1}if(v&&!f)return i||(i=new go),u||Ao(t)?mo(t,e,r,n,o,i):jo(t,e,c,r,n,o,i);if(!(1&r)){var h=f&&To.call(t,"__wrapped__"),p=l&&To.call(e,"__wrapped__");if(h||p){var y=h?t.value():t,d=p?e.value():e;return i||(i=new go),o(y,d,r,n,i)}}return!!v&&(i||(i=new go),_o(t,e,r,n,o,i))},Uo=A;var ko=function t(e,r,n,o,i){return e===r||(null==e||null==r||!Uo(e)&&!Uo(r)?e!=e&&r!=r:Do(e,r,n,o,t,i))},No=jr,Io=ko;var Bo=I;var Co=function(t){return t==t&&!Bo(t)},Eo=Co,Po=Hn;var Fo=function(t,e){return function(r){return null!=r&&(r[t]===e&&(void 0!==e||t in Object(r)))}},zo=function(t,e,r,n){var o=r.length,i=o,u=!n;if(null==t)return!i;for(t=Object(t);o--;){var a=r[o];if(u&&a[2]?a[1]!==t[a[0]]:!(a[0]in t))return!1}for(;++o<i;){var c=(a=r[o])[0],s=t[c],f=a[1];if(u&&a[2]){if(void 0===s&&!(c in t))return!1}else{var l=new No;if(n)var v=n(s,f,c,t,e,l);if(!(void 0===v?Io(f,s,3,n,l):v))return!1}}return!0},Ro=function(t){for(var e=Po(t),r=e.length;r--;){var n=e[r],o=t[n];e[r]=[n,o,Eo(o)]}return e},Wo=Fo;var Lo=me,Ho=on,Yo=c,qo=sn,Jo=fn,Vo=_e;var Go=function(t,e,r){for(var n=-1,o=(e=Lo(e,t)).length,i=!1;++n<o;){var u=Vo(e[n]);if(!(i=null!=t&&r(t,u)))break;t=t[u]}return i||++n!=o?i:!!(o=null==t?0:t.length)&&Jo(o)&&qo(u,o)&&(Yo(t)||Ho(t))},Zo=function(t,e){return null!=t&&e in Object(t)},Qo=Go;var Ko=function(t,e){return null!=t&&Qo(t,e,Zo)},Xo=ko,ti=xe,ei=Ko,ri=N,ni=Co,oi=Fo,ii=_e;var ui=function(t,e){return ri(t)&&ni(e)?oi(ii(t),e):function(r){var n=ti(r,t);return void 0===n&&n===e?ei(r,t):Xo(e,n,3)}};var ai=function(t){return t};var ci=function(t){return function(e){return null==e?void 0:e[t]}},si=Se;var fi=function(t){return function(e){return si(e,t)}},li=ci,vi=fi,hi=N,pi=_e;var yi=function(t){return hi(t)?li(pi(t)):vi(t)},di=function(t){var e=Ro(t);return 1==e.length&&e[0][2]?Wo(e[0][0],e[0][1]):function(r){return r===t||zo(r,t,e)}},bi=ui,gi=ai,mi=c,ji=yi;var _i=function(t){return"function"==typeof t?t:null==t?gi:"object"==typeof t?mi(t)?bi(t[0],t[1]):di(t):ji(t)};var wi=function(t){return function(e,r,n){for(var o=-1,i=Object(e),u=n(e),a=u.length;a--;){var c=u[t?a:++o];if(!1===r(i[c],c,i))break}return e}}(),Oi=wi,Si=Hn;var Ai=zn;var xi=function(t,e){return function(r,n){if(null==r)return r;if(!Ai(r))return t(r,n);for(var o=r.length,i=e?o:-1,u=Object(r);(e?i--:++i<o)&&!1!==n(u[i],i,u););return r}}((function(t,e){return t&&Oi(t,e,Si)})),$i=xi,Mi=zn;var Ti=ue,Di=_i,Ui=function(t,e){var r=-1,n=Mi(t)?Array(t.length):[];return $i(t,(function(t,o,i){n[++r]=e(t,o,i)})),n},ki=c;var Ni=function(t,e){return(ki(t)?Ti:Ui)(t,Di(e))},Ii={};var Bi=function(t,e){for(var r=-1,n=null==t?0:t.length;++r<n&&!1!==e(t[r],r,t););return t},Ci=ai;var Ei=Bi,Pi=xi,Fi=function(t){return"function"==typeof t?t:Ci},zi=c;var Ri=function(t,e){return(zi(t)?Ei:Pi)(t,Fi(e))};!function(t){t.exports=Ri}({get exports(){return Ii},set exports(t){Ii=t}});var Wi=a(Ii),Li=rt,Hi=function(){try{var t=Li(Object,"defineProperty");return t({},"",{}),t}catch(t){}}(),Yi=Hi;var qi=function(t,e,r){"__proto__"==e&&Yi?Yi(t,e,{configurable:!0,enumerable:!0,value:r,writable:!0}):t[e]=r},Ji=qi,Vi=_t,Gi=Object.prototype.hasOwnProperty;var Zi=function(t,e,r){var n=t[e];Gi.call(t,e)&&Vi(n,r)&&(void 0!==r||e in t)||Ji(t,e,r)},Qi=Zi,Ki=qi;var Xi=function(t,e,r,n){var o=!r;r||(r={});for(var i=-1,u=e.length;++i<u;){var a=e[i],c=n?n(r[a],t[a],a,r,t):void 0;void 0===c&&(c=t[a]),o?Ki(r,a,c):Qi(r,a,c)}return r},tu=Xi,eu=Hn;var ru=function(t,e){return t&&tu(e,eu(e),t)};var nu=I,ou=Un,iu=function(t){var e=[];if(null!=t)for(var r in Object(t))e.push(r);return e},uu=Object.prototype.hasOwnProperty;var au=Tn,cu=function(t){if(!nu(t))return iu(t);var e=ou(t),r=[];for(var n in t)("constructor"!=n||!e&&uu.call(t,n))&&r.push(n);return r},su=zn;var fu=function(t){return su(t)?au(t,!0):cu(t)},lu=Xi,vu=fu;var hu=function(t,e){return t&&lu(e,vu(e),t)},pu={};!function(t,e){var r=v,n=e&&!e.nodeType&&e,o=n&&t&&!t.nodeType&&t,i=o&&o.exports===n?r.Buffer:void 0,u=i?i.allocUnsafe:void 0;t.exports=function(t,e){if(e)return t.slice();var r=t.length,n=u?u(r):new t.constructor(r);return t.copy(n),n}}({get exports(){return pu},set exports(t){pu=t}},pu);var yu=function(t,e){var r=-1,n=t.length;for(e||(e=Array(n));++r<n;)e[r]=t[r];return e},du=Xi,bu=Vr;var gu=function(t,e){return du(t,bu(t),e)},mu=kn(Object.getPrototypeOf,Object),ju=Fr,_u=mu,wu=Vr,Ou=Lr,Su=Object.getOwnPropertySymbols?function(t){for(var e=[];t;)ju(e,wu(t)),t=_u(t);return e}:Ou,Au=Xi,xu=Su;var $u=function(t,e){return Au(t,xu(t),e)},Mu=Wr,Tu=Su,Du=fu;var Uu=function(t){return Mu(t,Du,Tu)},ku=Object.prototype.hasOwnProperty;var Nu=function(t){var e=t.length,r=new t.constructor(e);return e&&"string"==typeof t[0]&&ku.call(t,"index")&&(r.index=t.index,r.input=t.input),r},Iu=Tr;var Bu=function(t){var e=new t.constructor(t.byteLength);return new Iu(e).set(new Iu(t)),e},Cu=Bu;var Eu=function(t,e){var r=e?Cu(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.byteLength)},Pu=/\w*$/;var Fu=function(t){var e=new t.constructor(t.source,Pu.exec(t));return e.lastIndex=t.lastIndex,e},zu=h?h.prototype:void 0,Ru=zu?zu.valueOf:void 0;var Wu=Bu;var Lu=function(t,e){var r=e?Wu(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.length)},Hu=Bu,Yu=Eu,qu=Fu,Ju=function(t){return Ru?Object(Ru.call(t)):{}},Vu=Lu;var Gu=function(t,e,r){var n=t.constructor;switch(e){case"[object ArrayBuffer]":return Hu(t);case"[object Boolean]":case"[object Date]":return new n(+t);case"[object DataView]":return Yu(t,r);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return Vu(t,r);case"[object Map]":case"[object Set]":return new n;case"[object Number]":case"[object String]":return new n(t);case"[object RegExp]":return qu(t);case"[object Symbol]":return Ju(t)}},Zu=I,Qu=Object.create,Ku=function(){function t(){}return function(e){if(!Zu(e))return{};if(Qu)return Qu(e);t.prototype=e;var r=new t;return t.prototype=void 0,r}}(),Xu=mu,ta=Un;var ea=function(t){return"function"!=typeof t.constructor||ta(t)?{}:Ku(Xu(t))},ra=bo,na=A;var oa=function(t){return na(t)&&"[object Map]"==ra(t)},ia=dn,ua=bn&&bn.isMap,aa=ua?ia(ua):oa,ca=bo,sa=A;var fa=function(t){return sa(t)&&"[object Set]"==ca(t)},la=dn,va=bn&&bn.isSet,ha=va?la(va):fa,pa=jr,ya=Bi,da=Zi,ba=ru,ga=hu,ma=pu,ja=yu,_a=gu,wa=$u,Oa=Vn,Sa=Uu,Aa=bo,xa=Nu,$a=Gu,Ma=ea,Ta=c,Da=un,Ua=aa,ka=I,Na=ha,Ia=Hn,Ba=fu,Ca="[object Arguments]",Ea="[object Function]",Pa="[object Object]",Fa={};Fa[Ca]=Fa["[object Array]"]=Fa["[object ArrayBuffer]"]=Fa["[object DataView]"]=Fa["[object Boolean]"]=Fa["[object Date]"]=Fa["[object Float32Array]"]=Fa["[object Float64Array]"]=Fa["[object Int8Array]"]=Fa["[object Int16Array]"]=Fa["[object Int32Array]"]=Fa["[object Map]"]=Fa["[object Number]"]=Fa[Pa]=Fa["[object RegExp]"]=Fa["[object Set]"]=Fa["[object String]"]=Fa["[object Symbol]"]=Fa["[object Uint8Array]"]=Fa["[object Uint8ClampedArray]"]=Fa["[object Uint16Array]"]=Fa["[object Uint32Array]"]=!0,Fa["[object Error]"]=Fa[Ea]=Fa["[object WeakMap]"]=!1;var za=function t(e,r,n,o,i,u){var a,c=1&r,s=2&r,f=4&r;if(n&&(a=i?n(e,o,i,u):n(e)),void 0!==a)return a;if(!ka(e))return e;var l=Ta(e);if(l){if(a=xa(e),!c)return ja(e,a)}else{var v=Aa(e),h=v==Ea||"[object GeneratorFunction]"==v;if(Da(e))return ma(e,c);if(v==Pa||v==Ca||h&&!i){if(a=s||h?{}:Ma(e),!c)return s?wa(e,ga(a,e)):_a(e,ba(a,e))}else{if(!Fa[v])return i?e:{};a=$a(e,v,c)}}u||(u=new pa);var p=u.get(e);if(p)return p;u.set(e,a),Na(e)?e.forEach((function(o){a.add(t(o,r,n,o,e,u))})):Ua(e)&&e.forEach((function(o,i){a.set(i,t(o,r,n,i,e,u))}));var y=l?void 0:(f?s?Sa:Oa:s?Ba:Ia)(e);return ya(y||e,(function(o,i){y&&(o=e[i=o]),da(a,i,t(o,r,n,i,e,u))})),a},Ra=za;var Wa=function(t){return Ra(t,5)};function La(){let t,e,r=new Promise((function(){t=arguments[0],e=arguments[1]}));return r.resolve=t,r.reject=e,r}var Ha=S,Ya=c,qa=A;var Ja=function(t){return"string"==typeof t||!Ya(t)&&qa(t)&&"[object String]"==Ha(t)},Va=ci("length"),Ga=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]");var Za=function(t){return Ga.test(t)},Qa="\\ud800-\\udfff",Ka="["+Qa+"]",Xa="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",tc="\\ud83c[\\udffb-\\udfff]",ec="[^"+Qa+"]",rc="(?:\\ud83c[\\udde6-\\uddff]){2}",nc="[\\ud800-\\udbff][\\udc00-\\udfff]",oc="(?:"+Xa+"|"+tc+")"+"?",ic="[\\ufe0e\\ufe0f]?",uc=ic+oc+("(?:\\u200d(?:"+[ec,rc,nc].join("|")+")"+ic+oc+")*"),ac="(?:"+[ec+Xa+"?",Xa,rc,nc,Ka].join("|")+")",cc=RegExp(tc+"(?="+tc+")|"+ac+uc,"g");var sc=Va,fc=Za,lc=function(t){for(var e=cc.lastIndex=0;cc.test(t);)++e;return e};var vc=En,hc=bo,pc=zn,yc=Ja,dc=function(t){return fc(t)?lc(t):sc(t)};var bc=function(t){if(null==t)return 0;if(pc(t))return yc(t)?dc(t):t.length;var e=hc(t);return"[object Map]"==e||"[object Set]"==e?t.size:vc(t).length},gc=Xe,mc=Ve,jc=pe,_c=v.isFinite,wc=Math.min;var Oc=function(t){var e=Math[t];return function(t,r){if(t=mc(t),(r=null==r?0:wc(gc(r),292))&&_c(t)){var n=(jc(t)+"e").split("e"),o=e(n[0]+"e"+(+n[1]+r));return+((n=(jc(o)+"e").split("e"))[0]+"e"+(+n[1]-r))}return e(t)}}("round");function Sc(t){if(!nr(t))return 0;t=or(t);let e=Oc(t);return"0"===String(e)?0:e}function Ac(t){if(!ir(t))return!1;return Sc(t)>0}function xc(t){if(Te(t)){for(let e in t)return!0;return!1}return!1}function $c(t,e){return!!Te(t)&&(!(!rr(e)&&!nr(e))&&e in t)}function Mc(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=cr(),r={},n=null,o=xe(t,"timeAlive");Ac(o)||(o=1e4),o=Sc(o);let i=xe(t,"timeDetect");return Ac(i)||(i=50),i=Sc(i),e.trigger=function(t,u){rr(t)?($c(r,t)||setTimeout((()=>{e.emit("message",{eventName:"enter",key:t,data:u,now:bc(r)})}),1),r[t]={data:u,time:Date.now()},null===n&&(n=setInterval((()=>{Wi(r,((t,n)=>{if(Date.now()-t.time>o){let t=Wa(r[n]);delete r[n],e.emit("message",{eventName:"leave",key:n,data:t.data,now:bc(r)})}})),xc(r)||(clearInterval(n),n=null)}),i))):console.log("trigger need key")},e.get=function(){let t=[];return Wi(r,((e,r)=>{t.push({key:r,data:e.data})})),t=Wa(t),t},e}function Tc(t){return"[object ArrayBuffer]"===Object.prototype.toString.call(t)}function Dc(t){return"[object Uint8Array]"===Object.prototype.toString.call(t)}function Uc(t){return"[object Uint16Array]"===Object.prototype.toString.call(t)}function kc(t){if(!(Tc(t)||(e=t,"[object Blob]"===Object.prototype.toString.call(e))||Dc(t)||Uc(t)))return null;var e;try{if(t.byteLength)return t.byteLength}catch(t){}try{if(t.length)return t.length}catch(t){}try{if(t.size)return t.size}catch(t){}return null}var Nc=S,Ic=mu,Bc=A,Cc=Function.prototype,Ec=Object.prototype,Pc=Cc.toString,Fc=Ec.hasOwnProperty,zc=Pc.call(Object);var Rc=function(t){if(!Bc(t)||"[object Object]"!=Nc(t))return!1;var e=Ic(t);if(null===e)return!0;var r=Fc.call(e,"constructor")&&e.constructor;return"function"==typeof r&&r instanceof r&&Pc.call(r)==zc},Wc=S,Lc=A,Hc=Rc;var Yc=function(t){if(!Lc(t))return!1;var e=Wc(t);return"[object Error]"==e||"[object DOMException]"==e||"string"==typeof t.message&&"string"==typeof t.name&&!Hc(t)};var qc={};var Jc,Vc={},Gc={get exports(){return Vc},set exports(t){Vc=t}};function Zc(){return Jc||(Jc=1,function(t,e){var r;t.exports=(r=r||function(t,e){var r;if("undefined"!=typeof window&&window.crypto&&(r=window.crypto),"undefined"!=typeof self&&self.crypto&&(r=self.crypto),"undefined"!=typeof globalThis&&globalThis.crypto&&(r=globalThis.crypto),!r&&"undefined"!=typeof window&&window.msCrypto&&(r=window.msCrypto),!r&&void 0!==u&&u.crypto&&(r=u.crypto),!r)try{r=require("crypto")}catch(t){}var n=function(){if(r){if("function"==typeof r.getRandomValues)try{return r.getRandomValues(new Uint32Array(1))[0]}catch(t){}if("function"==typeof r.randomBytes)try{return r.randomBytes(4).readInt32LE()}catch(t){}}throw new Error("Native crypto module could not be used to get secure random number.")},o=Object.create||function(){function t(){}return function(e){var r;return t.prototype=e,r=new t,t.prototype=null,r}}(),i={},a=i.lib={},c=a.Base={extend:function(t){var e=o(this);return t&&e.mixIn(t),e.hasOwnProperty("init")&&this.init!==e.init||(e.init=function(){e.$super.init.apply(this,arguments)}),e.init.prototype=e,e.$super=this,e},create:function(){var t=this.extend();return t.init.apply(t,arguments),t},init:function(){},mixIn:function(t){for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);t.hasOwnProperty("toString")&&(this.toString=t.toString)},clone:function(){return this.init.prototype.extend(this)}},s=a.WordArray=c.extend({init:function(t,r){t=this.words=t||[],this.sigBytes=r!=e?r:4*t.length},toString:function(t){return(t||l).stringify(this)},concat:function(t){var e=this.words,r=t.words,n=this.sigBytes,o=t.sigBytes;if(this.clamp(),n%4)for(var i=0;i<o;i++){var u=r[i>>>2]>>>24-i%4*8&255;e[n+i>>>2]|=u<<24-(n+i)%4*8}else for(var a=0;a<o;a+=4)e[n+a>>>2]=r[a>>>2];return this.sigBytes+=o,this},clamp:function(){var e=this.words,r=this.sigBytes;e[r>>>2]&=4294967295<<32-r%4*8,e.length=t.ceil(r/4)},clone:function(){var t=c.clone.call(this);return t.words=this.words.slice(0),t},random:function(t){for(var e=[],r=0;r<t;r+=4)e.push(n());return new s.init(e,t)}}),f=i.enc={},l=f.Hex={stringify:function(t){for(var e=t.words,r=t.sigBytes,n=[],o=0;o<r;o++){var i=e[o>>>2]>>>24-o%4*8&255;n.push((i>>>4).toString(16)),n.push((15&i).toString(16))}return n.join("")},parse:function(t){for(var e=t.length,r=[],n=0;n<e;n+=2)r[n>>>3]|=parseInt(t.substr(n,2),16)<<24-n%8*4;return new s.init(r,e/2)}},v=f.Latin1={stringify:function(t){for(var e=t.words,r=t.sigBytes,n=[],o=0;o<r;o++){var i=e[o>>>2]>>>24-o%4*8&255;n.push(String.fromCharCode(i))}return n.join("")},parse:function(t){for(var e=t.length,r=[],n=0;n<e;n++)r[n>>>2]|=(255&t.charCodeAt(n))<<24-n%4*8;return new s.init(r,e)}},h=f.Utf8={stringify:function(t){try{return decodeURIComponent(escape(v.stringify(t)))}catch(t){throw new Error("Malformed UTF-8 data")}},parse:function(t){return v.parse(unescape(encodeURIComponent(t)))}},p=a.BufferedBlockAlgorithm=c.extend({reset:function(){this._data=new s.init,this._nDataBytes=0},_append:function(t){"string"==typeof t&&(t=h.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes},_process:function(e){var r,n=this._data,o=n.words,i=n.sigBytes,u=this.blockSize,a=i/(4*u),c=(a=e?t.ceil(a):t.max((0|a)-this._minBufferSize,0))*u,f=t.min(4*c,i);if(c){for(var l=0;l<c;l+=u)this._doProcessBlock(o,l);r=o.splice(0,c),n.sigBytes-=f}return new s.init(r,f)},clone:function(){var t=c.clone.call(this);return t._data=this._data.clone(),t},_minBufferSize:0});a.Hasher=p.extend({cfg:c.extend(),init:function(t){this.cfg=this.cfg.extend(t),this.reset()},reset:function(){p.reset.call(this),this._doReset()},update:function(t){return this._append(t),this._process(),this},finalize:function(t){return t&&this._append(t),this._doFinalize()},blockSize:16,_createHelper:function(t){return function(e,r){return new t.init(r).finalize(e)}},_createHmacHelper:function(t){return function(e,r){return new y.HMAC.init(t,r).finalize(e)}}});var y=i.algo={};return i}(Math),r)}(Gc)),Vc}!function(t,e){t.exports=Zc().enc.Utf8}({get exports(){return qc},set exports(t){qc=t}});var Qc=qc,Kc={};!function(t,e){var r;t.exports=(r=Zc(),function(){var t=r,e=t.lib.WordArray;function n(t,r,n){for(var o=[],i=0,u=0;u<r;u++)if(u%4){var a=n[t.charCodeAt(u-1)]<<u%4*2|n[t.charCodeAt(u)]>>>6-u%4*2;o[i>>>2]|=a<<24-i%4*8,i++}return e.create(o,i)}t.enc.Base64={stringify:function(t){var e=t.words,r=t.sigBytes,n=this._map;t.clamp();for(var o=[],i=0;i<r;i+=3)for(var u=(e[i>>>2]>>>24-i%4*8&255)<<16|(e[i+1>>>2]>>>24-(i+1)%4*8&255)<<8|e[i+2>>>2]>>>24-(i+2)%4*8&255,a=0;a<4&&i+.75*a<r;a++)o.push(n.charAt(u>>>6*(3-a)&63));var c=n.charAt(64);if(c)for(;o.length%4;)o.push(c);return o.join("")},parse:function(t){var e=t.length,r=this._map,o=this._reverseMap;if(!o){o=this._reverseMap=[];for(var i=0;i<r.length;i++)o[r.charCodeAt(i)]=i}var u=r.charAt(64);if(u){var a=t.indexOf(u);-1!==a&&(e=a)}return n(t,e,o)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),r.enc.Base64)}({get exports(){return Kc},set exports(t){Kc=t}});var Xc=Kc;function ts(t){if(!rr(t))return new Uint8Array;let e;try{e=function(t){if(!Ue(t))return new Uint8Array;let e=Xc.parse(t),r=e.words,n=e.sigBytes,o=new Uint8Array(n);for(let t=0;t<n;t++){let e=r[t>>>2]>>>24-t%4*8&255;o[t]=e}return o}(function(t){if(!rr(t))return"";let e=Qc.parse(t);return Xc.stringify(e)}(t))}catch(t){return new Uint8Array}return e}function es(t,e){return function(t,e,r,n,o,i){if(!nr(t))return null;if(!Dc(e))return null;if(!ir(r))return null;if(!Ee(n))return null;if(!ir(o))return null;if(!ir(i))return null;let u,a,c;t=or(t);let s=8*i-o-1,f=(1<<s)-1,l=f>>1,v=23===o?Math.pow(2,-24)-Math.pow(2,-77):0,h=n?i-1:0,p=n?-1:1,y=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,u=f):(u=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-u))<1&&(u--,c*=2),(t+=u+l>=1?v/c:v*Math.pow(2,1-l))*c>=2&&(u++,c/=2),u+l>=f?(a=0,u=f):u+l>=1?(a=(t*c-1)*Math.pow(2,o),u+=l):(a=t*Math.pow(2,l-1)*Math.pow(2,o),u=0));o>=8;e[r+h]=255&a,h+=p,a/=256,o-=8);for(u=u<<o|a,s+=o;s>0;e[r+h]=255&u,h+=p,u/=256,s-=8);return e[r+h-p]|=128*y,null}(t,e,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,!(arguments.length>3&&void 0!==arguments[3])||arguments[3],arguments.length>4&&void 0!==arguments[4]?arguments[4]:52,arguments.length>5&&void 0!==arguments[5]?arguments[5]:8)}function rs(t){let e=[],r=[];if(!Ne(t)&&!xc(t))return null;let n=[],o=[];function i(t){n.push(kc(t)),o.push(t)}try{let u=function(t){if(!Te(t))return{results:"",binarys:[]};if(De(t))return{results:"",binarys:[]};let e="",r=[];try{let n=-1;e=JSON.stringify(t,(function(t,e){if(Dc(e)){n+=1;let t=`[Uint8Array]::${n}`;return r.push(e),t}if(Uc(e)){n+=1;let t=`[Uint16Array]::${n}`;return r.push(e),t}if(Tc(e)){n+=1;let t=`[ArrayBuffer]::${n}`;return r.push(e),t}return Yc(e)&&(e=e.toString()),e}))}catch(t){}return{results:e,binarys:r}}(t);i(ts(u.results)),Wi(u.binarys,(t=>{i(t)}));let a=n,c=ts(JSON.stringify(a)),s=new Uint8Array(8);es(kc(c),s),e.push(s),e.push(c),Wi(o,(t=>{e.push(t)})),Wi(e,(t=>{r=function(t,e){let r=kc(t),n=kc(e),o=new Uint8Array(r+n);return o.set(new Uint8Array(t),0),o.set(new Uint8Array(e),r),o}(r,t)}))}catch(t){return null}return r}function ns(t){return function(t,e,r,n,o){if(!Dc(t))return null;if(!ir(e))return null;if(!Ee(r))return null;if(!ir(n))return null;if(!ir(o))return null;let i,u,a=8*o-n-1,c=(1<<a)-1,s=c>>1,f=-7,l=r?0:o-1,v=r?1:-1,h=t[e+l];for(l+=v,i=h&(1<<-f)-1,h>>=-f,f+=a;f>0;i=256*i+t[e+l],l+=v,f-=8);for(u=i&(1<<-f)-1,i>>=-f,f+=n;f>0;u=256*u+t[e+l],l+=v,f-=8);if(0===i)i=1-s;else{if(i===c)return u?NaN:1/0*(h?-1:1);u+=Math.pow(2,n),i-=s}return(h?-1:1)*u*Math.pow(2,i-n)}(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,!(arguments.length>2&&void 0!==arguments[2])||arguments[2],arguments.length>3&&void 0!==arguments[3]?arguments[3]:52,arguments.length>4&&void 0!==arguments[4]?arguments[4]:8)}var os={};!function(t,e){var r;t.exports=(r=Zc(),function(){if("function"==typeof ArrayBuffer){var t=r.lib.WordArray,e=t.init,n=t.init=function(t){if(t instanceof ArrayBuffer&&(t=new Uint8Array(t)),(t instanceof Int8Array||"undefined"!=typeof Uint8ClampedArray&&t instanceof Uint8ClampedArray||t instanceof Int16Array||t instanceof Uint16Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array||t instanceof Float64Array)&&(t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength)),t instanceof Uint8Array){for(var r=t.byteLength,n=[],o=0;o<r;o++)n[o>>>2]|=t[o]<<24-o%4*8;e.call(this,n,r)}else e.apply(this,arguments)};n.prototype=t}}(),r.lib.WordArray)}({get exports(){return os},set exports(t){os=t}});var is=os;function us(t){if(!Dc(t))return"";let e;try{r=function(t){return Dc(t)?is.create(t).toString(Xc):""}(t),e=rr(r)?Xc.parse(r).toString(Qc):""}catch(t){return""}var r;return e}function as(t){let e=null;if(!Dc(t))return null;try{let r=8,n=t.slice(0,r),o=t.slice(r,kc(t)),i=ns(n),u=o.slice(0,i),a=o.slice(i,kc(o)),c=us(u),s=function(t,e){let r=0,n=0,o=[];return Wi(e,(e=>{n=r+e;let i=t.slice(r,n);r=n,o.push(i)})),o}(a,JSON.parse(c));e=function(t){if(!xc(t))return{};let{results:e,binarys:r}=t;if(!rr(e))return{};if(!$e(r))return{};let n={};try{n=JSON.parse(e,(function(t,e){if(rr(e)){if(e.indexOf("[Uint8Array]::")>=0){let t=Sc(e.replace("[Uint8Array]::",""));return r[t]}if(e.indexOf("[Uint16Array]::")>=0){let t=Sc(e.replace("[Uint16Array]::",""));return r[t]}if(e.indexOf("[ArrayBuffer]::")>=0){let t=Sc(e.replace("[ArrayBuffer]::",""));return r[t]}}return e}))}catch(t){}return n}({results:us(s.shift()),binarys:s})}catch(t){}return e}function cs(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i={};o.port||(o.port=8080),o.apiName||(o.apiName="api");let u,a=new r.EventEmitter,c=Mc();function s(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];setTimeout((()=>{a.emit(t,...r)}),1)}async function f(t){let e=La(),r=La(),n=xe(t,"_mode","");if(r.then((r=>{t.output=r,delete t.input,e.resolve(t)})).catch((t=>{e.reject(t)})),"execute"===n){s("execute",xe(t,"func",""),xe(t,"input",null),r)}else if("broadcast"===n){s("broadcast",xe(t,"input",null)),r.resolve("ok")}else if("deliver"===n){s("deliver",xe(t,"input",null)),r.resolve("ok")}else if("polling"===n){let e=xe(t,"clientId",""),n=xe(i,e,[]);n=Wa(n),i[e]=[],r.resolve(n)}else{let n="can not find _mode in data";!function(t,e){s("error",{msg:t,err:e})}(n,t),e.reject(n),r.reject()}return e}setInterval((()=>{let t=c.get(),e=Ni(t,"key"),r={};Wi(e,(t=>{r[t]=xe(i,t,[])})),i=r}),1e3),u=o.serverHapi?o.serverHapi:t.server({port:o.port,routes:{cors:{origin:["*"]}}}),s("open"),c.on("message",(function(t){let{eventName:e,key:r,data:n,now:o}=t;"enter"===e?s("clientEnter",r,n):"leave"===e&&s("clientLeave",r,n),s("clientChange",o)}));let l={path:"/"+o.apiName,method:"POST",options:{payload:{maxBytes:1073741824,timeout:18e4,multipart:!0},timeout:{socket:3e5}},handler:async function(t,e){let r=xe(t,"headers");r=xc(r)?r:"";let o=xe(t,"query");o=xc(o)?o:"",s("handler",{headers:r,query:o});let i=xe(t,"payload.bb",null);Ue(i)&&(i=Buffer.from(i,"utf8"));let u=as(new Uint8Array(i)),a=xe(u,"clientId"),l={headers:t.headers,info:t.info};c.trigger(a,l);let v={};await f(u).then((function(t){v.success=t})).catch((function(t){v.error=t}));let h=rs(v),p=new n.Readable;return p._read=()=>{},p.push(h),p.push(null),e.response(p).header("Cache-Control","no-cache, no-store, must-revalidate").header("Content-Type","application/octet-stream").header("Content-Length",p.readableLength)}};return a.broadcast=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};if(ke(i))return;let r={};Wi(i,((e,n)=>{e.push({mode:"broadcast",data:t}),r[n]=e})),i=r,e(100)},a.deliver=function(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},n=xe(i,t,[]);n.push({mode:"deliver",data:e}),i[t]=n,r(100)},o.serverHapi?o.serverHapi.route(l):async function(){await u.register(e),u.route([{method:"GET",path:"/{file*}",handler:{directory:{path:"./"}}},l]),await u.start(),console.log(`Server running at: ${u.info.uri}`)}(),a}let ss="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),fs=ss.length;function ls(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:32,e=[];t=Ac(t)?Sc(t):32;for(let r=0;r<t;r++)e[r]=ss[0|Math.random()*fs];return e.join("")}var vs=v,hs=I,ps=function(){return vs.Date.now()},ys=Ve,ds=Math.max,bs=Math.min;var gs=function(t,e,r){var n,o,i,u,a,c,s=0,f=!1,l=!1,v=!0;if("function"!=typeof t)throw new TypeError("Expected a function");function h(e){var r=n,i=o;return n=o=void 0,s=e,u=t.apply(i,r)}function p(t){var r=t-c;return void 0===c||r>=e||r<0||l&&t-s>=i}function y(){var t=ps();if(p(t))return d(t);a=setTimeout(y,function(t){var r=e-(t-c);return l?bs(r,i-(t-s)):r}(t))}function d(t){return a=void 0,v&&n?h(t):(n=o=void 0,u)}function b(){var t=ps(),r=p(t);if(n=arguments,o=this,c=t,r){if(void 0===a)return function(t){return s=t,a=setTimeout(y,e),f?h(t):u}(c);if(l)return clearTimeout(a),a=setTimeout(y,e),h(c)}return void 0===a&&(a=setTimeout(y,e)),u}return e=ys(e)||0,hs(r)&&(f=!!r.leading,i=(l="maxWait"in r)?ds(ys(r.maxWait)||0,e):i,v="trailing"in r?!!r.trailing:v),b.cancel=function(){void 0!==a&&clearTimeout(a),s=0,n=c=o=a=void 0},b.flush=function(){return void 0===a?u:d(ps())},b},ms=qi,js=_t;var _s=function(t,e,r){(void 0!==r&&!js(t[e],r)||void 0===r&&!(e in t))&&ms(t,e,r)},ws=zn,Os=A;var Ss=function(t,e){if(("constructor"!==e||"function"!=typeof t[e])&&"__proto__"!=e)return t[e]},As=Xi,xs=fu;var $s=_s,Ms=pu,Ts=Lu,Ds=yu,Us=ea,ks=on,Ns=c,Is=function(t){return Os(t)&&ws(t)},Bs=un,Cs=P,Es=I,Ps=Rc,Fs=_n,zs=Ss,Rs=function(t){return As(t,xs(t))};var Ws=jr,Ls=_s,Hs=wi,Ys=function(t,e,r,n,o,i,u){var a=zs(t,r),c=zs(e,r),s=u.get(c);if(s)$s(t,r,s);else{var f=i?i(a,c,r+"",t,e,u):void 0,l=void 0===f;if(l){var v=Ns(c),h=!v&&Bs(c),p=!v&&!h&&Fs(c);f=c,v||h||p?Ns(a)?f=a:Is(a)?f=Ds(a):h?(l=!1,f=Ms(c,!0)):p?(l=!1,f=Ts(c,!0)):f=[]:Ps(c)||ks(c)?(f=a,ks(a)?f=Rs(a):Es(a)&&!Cs(a)||(f=Us(c))):l=!1}l&&(u.set(c,f),o(f,c,n,i,u),u.delete(c)),$s(t,r,f)}},qs=I,Js=fu,Vs=Ss;var Gs=function t(e,r,n,o,i){e!==r&&Hs(r,(function(u,a){if(i||(i=new Ws),qs(u))Ys(e,r,a,n,t,o,i);else{var c=o?o(Vs(e,a),u,a+"",e,r,i):void 0;void 0===c&&(c=u),Ls(e,a,c)}}),Js)};var Zs=function(t,e,r){switch(r.length){case 0:return t.call(e);case 1:return t.call(e,r[0]);case 2:return t.call(e,r[0],r[1]);case 3:return t.call(e,r[0],r[1],r[2])}return t.apply(e,r)},Qs=Math.max;var Ks=function(t,e,r){return e=Qs(void 0===e?t.length-1:e,0),function(){for(var n=arguments,o=-1,i=Qs(n.length-e,0),u=Array(i);++o<i;)u[o]=n[e+o];o=-1;for(var a=Array(e+1);++o<e;)a[o]=n[o];return a[e]=r(u),Zs(t,this,a)}};var Xs=function(t){return function(){return t}},tf=Hi,ef=tf?function(t,e){return tf(t,"toString",{configurable:!0,enumerable:!1,value:Xs(e),writable:!0})}:ai,rf=Date.now;var nf=function(t){var e=0,r=0;return function(){var n=rf(),o=16-(n-r);if(r=n,o>0){if(++e>=800)return arguments[0]}else e=0;return t.apply(void 0,arguments)}},of=nf(ef),uf=ai,af=Ks,cf=of;var sf=_t,ff=zn,lf=sn,vf=I;var hf=function(t,e){return cf(af(t,e,uf),t+"")},pf=function(t,e,r){if(!vf(r))return!1;var n=typeof e;return!!("number"==n?ff(r)&&lf(e,r.length):"string"==n&&e in r)&&sf(r[e],t)};var yf=Gs,df=function(t){return hf((function(e,r){var n=-1,o=r.length,i=o>1?r[o-1]:void 0,u=o>2?r[2]:void 0;for(i=t.length>3&&"function"==typeof i?(o--,i):void 0,u&&pf(r[0],r[1],u)&&(i=o<3?void 0:i,o=1),e=Object(e);++n<o;){var a=r[n];a&&t(e,a,n,i)}return e}))}((function(t,e,r){yf(t,e,r)})),bf={};!function(t,e){t.exports=function(){var t=1e3,e=6e4,r=36e5,n="millisecond",o="second",i="minute",u="hour",a="day",c="week",s="month",f="quarter",l="year",v="date",h="Invalid Date",p=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,y=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,d={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(t){var e=["th","st","nd","rd"],r=t%100;return"["+t+(e[(r-20)%10]||e[r]||e[0])+"]"}},b=function(t,e,r){var n=String(t);return!n||n.length>=e?t:""+Array(e+1-n.length).join(r)+t},g={s:b,z:function(t){var e=-t.utcOffset(),r=Math.abs(e),n=Math.floor(r/60),o=r%60;return(e<=0?"+":"-")+b(n,2,"0")+":"+b(o,2,"0")},m:function t(e,r){if(e.date()<r.date())return-t(r,e);var n=12*(r.year()-e.year())+(r.month()-e.month()),o=e.clone().add(n,s),i=r-o<0,u=e.clone().add(n+(i?-1:1),s);return+(-(n+(r-o)/(i?o-u:u-o))||0)},a:function(t){return t<0?Math.ceil(t)||0:Math.floor(t)},p:function(t){return{M:s,y:l,w:c,d:a,D:v,h:u,m:i,s:o,ms:n,Q:f}[t]||String(t||"").toLowerCase().replace(/s$/,"")},u:function(t){return void 0===t}},m="en",j={};j[m]=d;var _=function(t){return t instanceof A},w=function t(e,r,n){var o;if(!e)return m;if("string"==typeof e){var i=e.toLowerCase();j[i]&&(o=i),r&&(j[i]=r,o=i);var u=e.split("-");if(!o&&u.length>1)return t(u[0])}else{var a=e.name;j[a]=e,o=a}return!n&&o&&(m=o),o||!n&&m},O=function(t,e){if(_(t))return t.clone();var r="object"==typeof e?e:{};return r.date=t,r.args=arguments,new A(r)},S=g;S.l=w,S.i=_,S.w=function(t,e){return O(t,{locale:e.$L,utc:e.$u,x:e.$x,$offset:e.$offset})};var A=function(){function d(t){this.$L=w(t.locale,null,!0),this.parse(t)}var b=d.prototype;return b.parse=function(t){this.$d=function(t){var e=t.date,r=t.utc;if(null===e)return new Date(NaN);if(S.u(e))return new Date;if(e instanceof Date)return new Date(e);if("string"==typeof e&&!/Z$/i.test(e)){var n=e.match(p);if(n){var o=n[2]-1||0,i=(n[7]||"0").substring(0,3);return r?new Date(Date.UTC(n[1],o,n[3]||1,n[4]||0,n[5]||0,n[6]||0,i)):new Date(n[1],o,n[3]||1,n[4]||0,n[5]||0,n[6]||0,i)}}return new Date(e)}(t),this.$x=t.x||{},this.init()},b.init=function(){var t=this.$d;this.$y=t.getFullYear(),this.$M=t.getMonth(),this.$D=t.getDate(),this.$W=t.getDay(),this.$H=t.getHours(),this.$m=t.getMinutes(),this.$s=t.getSeconds(),this.$ms=t.getMilliseconds()},b.$utils=function(){return S},b.isValid=function(){return!(this.$d.toString()===h)},b.isSame=function(t,e){var r=O(t);return this.startOf(e)<=r&&r<=this.endOf(e)},b.isAfter=function(t,e){return O(t)<this.startOf(e)},b.isBefore=function(t,e){return this.endOf(e)<O(t)},b.$g=function(t,e,r){return S.u(t)?this[e]:this.set(r,t)},b.unix=function(){return Math.floor(this.valueOf()/1e3)},b.valueOf=function(){return this.$d.getTime()},b.startOf=function(t,e){var r=this,n=!!S.u(e)||e,f=S.p(t),h=function(t,e){var o=S.w(r.$u?Date.UTC(r.$y,e,t):new Date(r.$y,e,t),r);return n?o:o.endOf(a)},p=function(t,e){return S.w(r.toDate()[t].apply(r.toDate("s"),(n?[0,0,0,0]:[23,59,59,999]).slice(e)),r)},y=this.$W,d=this.$M,b=this.$D,g="set"+(this.$u?"UTC":"");switch(f){case l:return n?h(1,0):h(31,11);case s:return n?h(1,d):h(0,d+1);case c:var m=this.$locale().weekStart||0,j=(y<m?y+7:y)-m;return h(n?b-j:b+(6-j),d);case a:case v:return p(g+"Hours",0);case u:return p(g+"Minutes",1);case i:return p(g+"Seconds",2);case o:return p(g+"Milliseconds",3);default:return this.clone()}},b.endOf=function(t){return this.startOf(t,!1)},b.$set=function(t,e){var r,c=S.p(t),f="set"+(this.$u?"UTC":""),h=(r={},r[a]=f+"Date",r[v]=f+"Date",r[s]=f+"Month",r[l]=f+"FullYear",r[u]=f+"Hours",r[i]=f+"Minutes",r[o]=f+"Seconds",r[n]=f+"Milliseconds",r)[c],p=c===a?this.$D+(e-this.$W):e;if(c===s||c===l){var y=this.clone().set(v,1);y.$d[h](p),y.init(),this.$d=y.set(v,Math.min(this.$D,y.daysInMonth())).$d}else h&&this.$d[h](p);return this.init(),this},b.set=function(t,e){return this.clone().$set(t,e)},b.get=function(t){return this[S.p(t)]()},b.add=function(n,f){var v,h=this;n=Number(n);var p=S.p(f),y=function(t){var e=O(h);return S.w(e.date(e.date()+Math.round(t*n)),h)};if(p===s)return this.set(s,this.$M+n);if(p===l)return this.set(l,this.$y+n);if(p===a)return y(1);if(p===c)return y(7);var d=(v={},v[i]=e,v[u]=r,v[o]=t,v)[p]||1,b=this.$d.getTime()+n*d;return S.w(b,this)},b.subtract=function(t,e){return this.add(-1*t,e)},b.format=function(t){var e=this,r=this.$locale();if(!this.isValid())return r.invalidDate||h;var n=t||"YYYY-MM-DDTHH:mm:ssZ",o=S.z(this),i=this.$H,u=this.$m,a=this.$M,c=r.weekdays,s=r.months,f=function(t,r,o,i){return t&&(t[r]||t(e,n))||o[r].slice(0,i)},l=function(t){return S.s(i%12||12,t,"0")},v=r.meridiem||function(t,e,r){var n=t<12?"AM":"PM";return r?n.toLowerCase():n},p={YY:String(this.$y).slice(-2),YYYY:this.$y,M:a+1,MM:S.s(a+1,2,"0"),MMM:f(r.monthsShort,a,s,3),MMMM:f(s,a),D:this.$D,DD:S.s(this.$D,2,"0"),d:String(this.$W),dd:f(r.weekdaysMin,this.$W,c,2),ddd:f(r.weekdaysShort,this.$W,c,3),dddd:c[this.$W],H:String(i),HH:S.s(i,2,"0"),h:l(1),hh:l(2),a:v(i,u,!0),A:v(i,u,!1),m:String(u),mm:S.s(u,2,"0"),s:String(this.$s),ss:S.s(this.$s,2,"0"),SSS:S.s(this.$ms,3,"0"),Z:o};return n.replace(y,(function(t,e){return e||p[t]||o.replace(":","")}))},b.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},b.diff=function(n,v,h){var p,y=S.p(v),d=O(n),b=(d.utcOffset()-this.utcOffset())*e,g=this-d,m=S.m(this,d);return m=(p={},p[l]=m/12,p[s]=m,p[f]=m/3,p[c]=(g-b)/6048e5,p[a]=(g-b)/864e5,p[u]=g/r,p[i]=g/e,p[o]=g/t,p)[y]||g,h?m:S.a(m)},b.daysInMonth=function(){return this.endOf(s).$D},b.$locale=function(){return j[this.$L]},b.locale=function(t,e){if(!t)return this.$L;var r=this.clone(),n=w(t,e,!0);return n&&(r.$L=n),r},b.clone=function(){return S.w(this.$d,this)},b.toDate=function(){return new Date(this.valueOf())},b.toJSON=function(){return this.isValid()?this.toISOString():null},b.toISOString=function(){return this.$d.toISOString()},b.toString=function(){return this.$d.toUTCString()},d}(),x=A.prototype;return O.prototype=x,[["$ms",n],["$s",o],["$m",i],["$H",u],["$W",a],["$M",s],["$y",l],["$D",v]].forEach((function(t){x[t[1]]=function(e){return this.$g(e,t[0],t[1])}})),O.extend=function(t,e){return t.$i||(t(e,A,O),t.$i=!0),O},O.locale=w,O.isDayjs=_,O.unix=function(t){return O(1e3*t)},O.en=j[m],O.Ls=j,O.p={},O}()}({get exports(){return bf},set exports(t){bf=t}});var gf=bf;let mf=o.resolve();function jf(){let t={},e=xe(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"fnTableTags");rr(e)||(e="tableTags.json"),e=`${mf}/${e}`;let r=cr();function n(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),o=1;o<e;o++)n[o-1]=arguments[o];setTimeout((()=>{r.emit(t,...n)}),1)}function o(){let t={};try{if(i.existsSync(e)){let r=function(t){if(!rr(t))return{};let e={};try{e=JSON.parse(t)}catch(t){e={}}return e}(i.readFileSync(e,"utf8"));xc(r)&&(t=r)}}catch(t){n("error",{msg:"readTableTags catch",err:t})}return t}function u(){try{let r=function(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(Me(t))return"";let r="";try{r=e?JSON.stringify(t,null,2):JSON.stringify(t)}catch(t){r=""}return r}(t);i.writeFileSync(e,r,"utf8")}catch(t){n("error",{msg:"writeTableTags catch",err:t})}}let a=gs((()=>{u(),n("changeTableTags",t)}),200);return r.readTableTags=o,r.writeTableTags=u,r.initTableTags=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"useInputFirst";t="useStorageFirst"===r?df(e,o()):"useInputOnly"===r?e:"useStorageOnly"===r?o():df(o(),e),u()},r.setTableTags=function(){t=df(t,arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),u()},r.getTableTags=function(){return t},r.updateTableTag=function(e){t[e]=gf().format("YYYY-MM-DDTHH:mm:ssZ")+"|"+ls(6),a()},r}function _f(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=cr(),r=xe(t,"instWConverServer",null);if(null===r)return e.emit("error","invalid opt.instWConverServer"),e;let n=xe(t,"dbORMs",null);if(!Te(n))return e.emit("error","invalid opt.dbORMs"),e;let o=xe(t,"tableNames",null);if(!$e(o))return e.emit("error","invalid opt.tableNames"),e;0===bc(o)&&console.log("opt.tableNames.lenght = 0");let i=xe(t,"fnTableTags",null);rr(i)||(i="tableTags.json");let u=new jf({fnTableTags:i});o=Wa(o);let a={};function c(t){let e={};return Wi(o,(r=>{let n=r,o=t[r];e[n]=o})),e}return Wi(o,(t=>{a[t]=ls(6)})),u.initTableTags(a,"useInputOnly"),Wi(o,(t=>{let e=n[t];if(!e)throw new Error(`invalid dbORMs.${t}`);e.on("change",(()=>{u.updateTableTag(t)}))})),r.on("clientEnter",(function(t,e){r.deliver(t,{mode:"syncTable",data:u.readTableTags()})})),u.on("changeTableTags",(t=>{r.broadcast({mode:"syncTable",data:c(t)})})),u}function wf(t){return wf="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},wf(t)}function Of(t){var e=function(t,e){if("object"!==wf(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==wf(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===wf(e)?e:String(e)}function Sf(t,e,r){return(e=Of(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Af(t){let e=Object.prototype.toString.call(t);return"[object Function]"===e||"[object AsyncFunction]"===e}function xf(t){let e,r=Object.prototype.toString.call(t);if(e="[object Promise]"===r,e)return!0;if("[object Function]"!==r)return!1;try{e="function"!=typeof t.subscribe&&"function"==typeof t.then}catch(t){}return e}function $f(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Mf(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?$f(Object(r),!0).forEach((function(e){Sf(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):$f(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}let Tf={},Df=null;async function Uf(t){let{func:e,input:r,pm:n}=t,o="";if(!$c(r,"__sysToken__"))return n.resolve({state:"error",msg:"invalid token"}),n;if(o=function(t){if(!rr(t)&&!nr(t)&&!M(t))return"";let e="";try{e=String(t)}catch(t){}try{e=t.toString()}catch(t){}return e}(r.__sysToken__),!$c(r,"__sysInputArgs__"))return n.resolve({state:"error",msg:"invalid input"}),n;r=r.__sysInputArgs__;let i="",u=Df(o);if(i=xf(u)?await u:u,rr(i)||(i=""),"getFuncList"===e){let t={state:"success",msg:Hn(Tf)};return n.resolve(t),n}if(!$c(Tf,e))return n.resolve({state:"error",msg:`invalid func[${e}]`}),n;let a=Tf[e];try{let t=await(c=a,function(){let t=La(),e=null,r=null;try{e=c.apply(this,arguments)}catch(t){r=t}return null!==r?t.resolve({state:"error",msg:r}):xf(e)?e.then((function(e){t.resolve({state:"success",msg:e})})).catch((function(e){"cancelled"===xe(e,"reason")?t.resolve({state:"cancelled",msg:""}):t.resolve({state:"error",msg:e})})):t.resolve({state:"success",msg:e}),t})(i,...r);n.resolve(t)}catch(t){n.resolve({state:"error",msg:`func: ${e}`})}var c;return n}function kf(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=cr(),r=xe(t,"instWConverServer",null);if(null===r)return e.emit("error","invalid opt.instWConverServer"),e;Df=xe(t,"cbGetUserIDFromToken",null),Af(Df)||(Df=async()=>"");let n=xe(t,"useDbORM",null);Ee(n)||(n=!0);let o=null;if(n&&(o=xe(t,"operORM",null),!Af(o)))return e.emit("error","invalid opt.operORM when useDbORM=true"),e;let i=[];if(n&&(i=xe(t,"tableNames",null),!$e(i)))return e.emit("error","invalid opt.tableNames when useDbORM=true"),e;let u=[];n&&(u=xe(t,"methods",null),$e(u)||(u=["select","insert","save","del"]));let a=xe(t,"extFuncs",null),c=xe(t,"hookBefores",null),s=xe(t,"hookAfters",null),f={};return n&&(i=Wa(i),f=function(t,e,r){let n={};return Wi(t,(t=>{Wi(e,(e=>{n[`${t}.${e}`]=async function(n,o){return await r(n,t,e,o)}}))})),n}(i,u,o)),Te(a)&&Wi(a,((t,e)=>{f[e]=t})),Tf=f,r.on("execute",(async function(t,r,n){let o={func:t,input:r,pm:n};if(Af(c))try{c(o)}catch(t){e.emit("error",t)}else Ne(c)&&Wi(c,(t=>{if(Af(t))try{t(o)}catch(t){e.emit("error",t)}}));let i=await Uf(o).catch((t=>{e.emit("error",t)})),u=Mf(Mf({},o),{},{output:i});if(Af(s))try{s(u)}catch(t){e.emit("error",t)}else Ne(s)&&Wi(s,(t=>{if(Af(t))try{t(u)}catch(t){e.emit("error",t)}}))})),e}function Nf(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=null,r=null,n=cr(),o=xe(t,"instWConverServer",null);if(null===o)return n.emit("error","invalid opt.instWConverServer"),n;let i=xe(t,"useDbORM",null);Ee(i)||(i=!0);let u=xe(t,"dbORMs",null),a=xe(t,"operORM",null),c=xe(t,"tableNamesExec",null),s=xe(t,"methodsExec",null),f=xe(t,"tableNamesSync",null),l=xe(t,"cbGetUserIDFromToken",null),v=xe(t,"extFuncs",null),h=xe(t,"hookBefores",null),p=xe(t,"hookAfters",null),y=xe(t,"fnTableTags",null);if(e=new kf({instWConverServer:o,cbGetUserIDFromToken:l,useDbORM:i,operORM:a,tableNames:c,methods:s,extFuncs:v,hookBefores:h,hookAfters:p}),e.on("error",(t=>{n.emit("error",t)})),i){if(!Te(u))return n.emit("error","invalid opt.dbORMs when useDbORM=true"),n;r=new _f({instWConverServer:o,dbORMs:u,tableNames:f,fnTableTags:y}),r.on("error",(t=>{n.emit("error",t)}))}return n.getInstWServWebdataServerExec=()=>e,n.getInstWServWebdataServerSync=()=>r,n}return function(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=null,o=null,i=null,u=cr(),a=xe(r,"port");ir(a)||(a=8080);let c=xe(r,"useCors");Ee(c)||(c=!0);let s=xe(r,"useInert");Ee(s)||(s=!0);let f=xe(r,"pathStaticFiles");rr(f)||(f="dist");let l=xe(r,"apis");Ne(l)||(l=[]);let v=xe(r,"getUserIDFromToken",null),h=xe(r,"useDbORM",null);Ee(h)||(h=!0);let p=xe(r,"dbORMs",null),y=xe(r,"operORM",null),d=xe(r,"tableNamesExec",null),b=xe(r,"methodsExec",null),g=xe(r,"tableNamesSync",null),m=xe(r,"extFuncs",null),j=xe(r,"hookBefores",null),_=xe(r,"hookAfters",null),w=xe(r,"fnTableTags",null),O=xe(r,"showLog");return Ee(O)||(O=!0),(async()=>{await(async()=>{n=new t.Server({port:a,routes:{cors:c}}),s&&await n.register(e);let r=[];s&&(r=[{method:"GET",path:"/{file*}",handler:{directory:{path:`${f}/`}}}]),r=[...r,...l],n.route(r)})(),await(async()=>{o=new cs({serverHapi:n}),o.on("open",(function(){O&&console.log(`Server[port:${a}]: open`)})),o.on("error",(function(t){O&&console.log(`Server[port:${a}]: error`,t),u.emit("error",{mode:"instWConverhpServer error",err:t})})),o.on("clientChange",(function(t){O&&console.log(`Server[port:${a}]: now clients: ${t}`)}))})(),await(async()=>{i=new Nf({instWConverServer:o,cbGetUserIDFromToken:v,useDbORM:h,dbORMs:p,operORM:y,tableNamesExec:d,tableNamesSync:g,methodsExec:b,extFuncs:m,hookBefores:j,hookAfters:_,fnTableTags:w}),i.on("error",(t=>{O&&console.log("error",t),u.emit("error",{mode:"instWServWebdataServer error",err:t})}))})(),await n.start(),O&&console.log(`Server running at: ${n.info.uri}`)})(),process.on("unhandledRejection",(t=>{console.log("unhandledRejection",t),u.emit("error",{mode:"unhandledRejection",err:t})})),process.on("uncaughtException",(t=>{console.log("uncaughtException",t),u.emit("error",{mode:"uncaughtException",err:t})})),u.getServer=()=>n,u.getInstWConverhpServer=()=>o,u.getInstWServWebdataServer=()=>i,u}}));
//# sourceMappingURL=w-serv-hapi-server.umd.js.map
